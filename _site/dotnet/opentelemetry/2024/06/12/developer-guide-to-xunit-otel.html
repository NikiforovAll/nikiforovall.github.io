<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>A .NET Developer Guide to XUnit Test Instrumentation with OpenTelemetry and Aspire Dashboard | N+1 Blog</title>

	<!-- Meta Description -->
	
	<meta name="description" content="In this guide, we will explored how to leverage XUnit and OpenTelemetry to instrument .NET test projects. The process of setting up the XUnit.Otel.Template demonstrates the ease with which developers can start instrumenting their tests, making it accessible even for those new to OpenTelemetry or Aspire Dashboard">
	

	<meta name="author" content="Oleksii Nikiforov">

	<!-- Canonical URL -->
	<link rel="canonical" href="http://localhost:4000/dotnet/opentelemetry/2024/06/12/developer-guide-to-xunit-otel.html">

	<!-- Open Graph -->
	<meta property="og:title" content="A .NET Developer Guide to XUnit Test Instrumentation with OpenTelemetry and Aspire Dashboard">
	<meta property="og:description" content="In this guide, we will explored how to leverage XUnit and OpenTelemetry to instrument .NET test projects. The process of setting up the XUnit.Otel.Template demonstrates the ease with which developers can start instrumenting their tests, making it accessible even for those new to OpenTelemetry or Aspire Dashboard">
	<meta property="og:url" content="http://localhost:4000/dotnet/opentelemetry/2024/06/12/developer-guide-to-xunit-otel.html">
	<meta property="og:site_name" content="N+1 Blog">
	<meta property="og:type" content="article">
	
	<meta property="article:published_time" content="2024-06-12T00:00:00+03:00">
	
	<meta property="og:image" content="http://localhost:4000/assets/media/default-post-image.png">

	<!-- Twitter Card -->
	<meta name="twitter:card" content="summary_large_image">
	<meta name="twitter:site" content="@nikiforovall">
	<meta name="twitter:title" content="A .NET Developer Guide to XUnit Test Instrumentation with OpenTelemetry and Aspire Dashboard">
	<meta name="twitter:description" content="In this guide, we will explored how to leverage XUnit and OpenTelemetry to instrument .NET test projects. The process of setting up the XUnit.Otel.Template demonstrates the ease with which developers can start instrumenting their tests, making it accessible even for those new to OpenTelemetry or Aspire Dashboard">
	<meta name="twitter:image" content="http://localhost:4000/assets/media/default-post-image.png">

	<!-- Enable responsive viewport -->
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
	<!--[if lt IE 9]>
	<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->

	<!-- Le styles -->
	<link href="/assets/resources/bootstrap/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
	<link href="/assets/resources/syntax/syntax.css" rel="stylesheet">
	<link href="/assets/css/style.css" rel="stylesheet">

	<!-- Search Feature Styles -->
	<style>
		.layout-page .search-trigger { position: fixed; top: 45px; right: 100px; z-index: 1000; display: flex; align-items: center; gap: 10px; padding: 6px 12px; background: #f5f5f5; border: 1px solid #ddd; border-radius: 4px; cursor: pointer; min-width: 220px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); transition: all 0.15s ease; height: 34px; box-sizing: border-box; }
		.layout-post .search-trigger { position: fixed; top: 45px; right: 100px; z-index: 1000; display: flex; align-items: center; justify-content: center; padding: 0; background: #f5f5f5; border: 1px solid #ddd; border-radius: 4px; cursor: pointer; width: 34px; height: 34px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); transition: all 0.15s ease; box-sizing: border-box; }
		.search-trigger:hover { background: #ebebeb; border-color: #c0c0c0; box-shadow: 0 2px 5px rgba(0,0,0,0.08); }
		.search-icon { color: #666; font-size: 14px; display: flex; align-items: center; }
		.search-placeholder { flex: 1; color: #999; font-size: 14px; user-select: none; }
		.search-keybind { display: flex; gap: 4px; align-items: center; }
		.search-key { font-family: 'Courier New', monospace; font-size: 11px; padding: 2px 6px; background: #e0e0e0; border: 1px solid #ccc; border-bottom: 2px solid #bbb; border-radius: 3px; color: #333; line-height: 1.2; box-shadow: 0 1px 1px rgba(0,0,0,0.1); }
		.layout-post .search-placeholder { display: none; }
		.layout-post .search-keybind { display: none; }
		.search-modal { position: fixed; top: 0; left: 0; right: 0; bottom: 0; z-index: 10000; display: none; align-items: flex-start; justify-content: center; padding-top: 10vh; }
		.search-modal.open { display: flex; animation: fadeIn 0.2s ease; }
		@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
		.search-backdrop { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.5); backdrop-filter: blur(2px); }
		.search-modal-container { position: relative; width: 90%; max-width: 600px; background: white; border-radius: 8px; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3); overflow: hidden; }
		.search-input-container { display: flex; align-items: center; padding: 16px 20px; border-bottom: 1px solid #e0e0e0; gap: 12px; }
		.search-modal-icon { color: #666; font-size: 18px; }
		.search-modal-input { flex: 1; border: none; outline: none; font-size: 16px; color: #333; background: transparent; }
		.search-modal-input::placeholder { color: #999; }
		.search-close-btn { background: transparent; border: none; color: #999; font-size: 18px; cursor: pointer; padding: 4px 8px; border-radius: 4px; transition: all 0.15s ease; }
		.search-close-btn:hover { background: #f0f0f0; color: #333; }
		.search-results { max-height: 60vh; overflow-y: auto; padding: 8px; }
		.search-hint { padding: 40px 20px; text-align: center; color: #999; font-size: 14px; }
		.search-result-item { padding: 12px 16px; border-radius: 6px; cursor: pointer; transition: background-color 0.15s ease; border: 2px solid transparent; margin-bottom: 4px; }
		.search-result-item:hover { background: #f5f5f5; }
		.search-result-item.selected { background: #e8f4f8; border-color: #4a90e2; }
		.search-footer { display: flex; justify-content: center; gap: 20px; padding: 12px 20px; border-top: 1px solid #e0e0e0; background: #fafafa; font-size: 12px; color: #666; }
		.search-footer kbd { font-family: 'Courier New', monospace; font-size: 11px; padding: 2px 5px; background: white; border: 1px solid #ddd; border-radius: 3px; color: #333; box-shadow: 0 1px 1px rgba(0,0,0,0.1); }
		@media (max-width: 768px) { .layout-page .search-trigger, .layout-post .search-trigger { display: none; } .search-modal { padding-top: 5vh; } .search-modal-container { width: 95%; max-width: none; margin: 0 10px; } .search-results { max-height: 50vh; } .search-footer { flex-wrap: wrap; gap: 10px; } }
	</style>

	<!-- Le fav and touch icons -->
	<!-- Update these with your own images
	<link rel="shortcut icon" href="images/favicon.ico">
	<link rel="apple-touch-icon" href="images/apple-touch-icon.png">
	<link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
	-->
	<link rel="shortcut icon" href="/assets/media/favicon.ico">

	<link rel="alternate" type="application/rss+xml" title="" href="http://localhost:4000/feed.xml">

	
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "A .NET Developer Guide to XUnit Test Instrumentation with OpenTelemetry and Aspire Dashboard",
  
  
  "description": "In this guide, we will explored how to leverage XUnit and OpenTelemetry to instrument .NET test projects. The process of setting up the XUnit.Otel.Template demonstrates the ease with which developers can start instrumenting their tests, making it accessible even for those new to OpenTelemetry or Aspire Dashboard",
  
  "image": ["http://localhost:4000/assets/media/default-post-image.png"],
  "datePublished": "2024-06-12T00:00:00+03:00",
  "dateModified": "2024-06-12T00:00:00+03:00",
  "author": {
    "@type": "Person",
    "name": "Oleksii Nikiforov",
    "url": "http://localhost:4000/about.html",
    "sameAs": [
      "https://github.com/nikiforovAll",
      "https://twitter.com/nikiforovall",
      "https://www.linkedin.com/in/nikiforov-oleksii",
      "https://t.me/nikiforovallblog"
    ]
  },
  "publisher": {
    "@type": "Person",
    "name": "Oleksii Nikiforov",
    "logo": {
      "@type": "ImageObject",
      "url": "https://www.gravatar.com/avatar/e86fa0938976c38907a302ecb208f011?s=200"
    }
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://localhost:4000/dotnet/opentelemetry/2024/06/12/developer-guide-to-xunit-otel.html"
  },
  
  "articleSection": "dotnet",
  
  
  "keywords": "dotnet, aspnetcore, opentelemetry, aspire",
  
  "inLanguage": "en-US"
}
</script>


</head>

<body class="layout-post">
	<nav class="navbar navbar-default visible-xs" role="navigation">
		<!-- Brand and toggle get grouped for better mobile display -->
		<div class="navbar-header">
			<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			
			<a type="button" class="navbar-toggle nav-link" href="http://github.com/nikiforovAll" target="_blank" rel="noopener noreferrer noopener noreferrer">
				<i class="fa-brands fa-github"></i>
			</a>
			
			
			<a type="button" class="navbar-toggle nav-link" href="http://x.com/nikiforovall" target="_blank" rel="noopener noreferrer noopener noreferrer">
				<i class="fa-brands fa-x-twitter"></i>
			</a>
			
			
			<a type="button" class="navbar-toggle nav-link" href="mailto:alexey.nikiforovall@gmail.com">
				<i class="fa-solid fa-envelope"></i>
			</a>
			
			<a class="navbar-brand" href="/">
				<img src="//www.gravatar.com/avatar/e86fa0938976c38907a302ecb208f011?s=35" class="img-circle">
				N+1 Blog
			</a>
		</div>

		<!-- Collect the nav links, forms, and other content for toggling -->
		<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
			<ul class="nav navbar-nav">
				<li class="active"><a href="/">Home</a></li>
				<li><a href="/topics.html">Topics</a></li>
				<li><a href="/about.html">About</a></li>
			</ul>
		</div>
<!-- /.navbar-collapse -->
	</nav>

	<!-- nav-menu-dropdown -->
	<div class="btn-group hidden-xs" id="nav-menu">
		<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
			<i class="fa-solid fa-bars"></i>
		</button>
		<ul class="dropdown-menu" role="menu">
			<li><a href="/"><i class="fa-solid fa-home"></i>Home</a></li>
			<li><a href="/topics.html"><i class="fa-solid fa-bookmark"></i>Topics</a></li>
			<li><a href="/about.html"><i class="fa-solid fa-pencil"></i>About</a></li>
			<li class="divider">
			<li><a href="#"><i class="fa-solid fa-arrow-up"></i>Top of Page</a></li>
		</ul>
	</div>

	<!-- Search Control -->
	<button id="search-trigger" class="search-trigger" type="button" aria-label="Open search">
		<span class="search-icon"><i class="fa-solid fa-search"></i></span>
		<span class="search-placeholder">Search</span>
		<div class="search-keybind">
			<kbd class="search-key" id="search-modifier">ctrl</kbd>
			<kbd class="search-key">K</kbd>
		</div>
	</button>

	<!-- Search Modal -->
	<div id="search-modal" class="search-modal">
		<div class="search-backdrop"></div>
		<div class="search-modal-container">
			<div class="search-input-container">
				<i class="fa-solid fa-search search-modal-icon"></i>
				<input type="text" id="search-input" class="search-modal-input" placeholder="Search blog posts..." autocomplete="off">
				<button id="search-close" class="search-close-btn" title="Close (ESC)">
					<i class="fa-solid fa-times"></i>
				</button>
			</div>
			<div id="search-results" class="search-results">
				<div class="search-hint">Type at least 2 characters to search...</div>
			</div>
			<div class="search-footer">
				<span><kbd>↑</kbd> <kbd>↓</kbd> to navigate</span>
				<span><kbd>↵</kbd> to select</span>
				<span><kbd>ESC</kbd> to close</span>
			</div>
		</div>
	</div>

	<div class="col-sm-3 sidebar hidden-xs" style="">
		<!-- sidebar.html -->
<header class="sidebar-header" role="banner">
	<a href="/">
		<img src="//www.gravatar.com/avatar/e86fa0938976c38907a302ecb208f011?s=150" class="img-circle">
	</a>
	<h3 class="title">
        <a href="/">N+1 Blog</a>
    </h3>
</header>


<div id="bio" class="text-center">
	Jibber-jabbering about programming and IT.
</div>


<div id="contact-list" class="text-center">
	<ul class="list-unstyled list-inline">
		
		<li>
			<a class="btn btn-default btn-sm" href="https://github.com/nikiforovAll" target="_blank" rel="noopener noreferrer noopener noreferrer">
				<i class="fa-brands fa-github fa-lg"></i>
			</a>
		</li>
		
		
		<li>
			<a class="btn btn-default btn-sm" href="https://x.com/nikiforovall" target="_blank" rel="noopener noreferrer noopener noreferrer">
				<i class="fa-brands fa-x-twitter fa-lg"></i>
			</a>
		</li>
		
		
		<li>
			<a class="btn btn-default btn-sm" href="https://t.me/nikiforovallblog" target="_blank" rel="noopener noreferrer noopener noreferrer">
				<i class="fa-brands fa-telegram fa-lg"></i>
			</a>
		</li>
		
		
		<li>
			<a class="btn btn-default btn-sm" href="https://linkedin.com/in/nikiforov-oleksii" target="_blank" rel="noopener noreferrer noopener noreferrer">
				<i class="fa-brands fa-linkedin fa-lg"></i>
			</a>
		</li>
		
	</ul>
	<ul id="contact-list-secondary" class="list-unstyled list-inline">
		
		<li>
			<a class="btn btn-default btn-sm" href="mailto:alexey.nikiforovall@gmail.com">
				<i class="fa-solid fa-envelope fa-lg"></i>
			</a>
		</li>
		
		<li>
			<a class="btn btn-default btn-sm" href="/feed.xml" target="_blank" rel="noopener noreferrer">
				<i class="fa-solid fa-rss fa-lg"></i>
			</a>
		</li>
	</ul>
</div>
<!-- sidebar.html end -->

	</div>

	<div class="col-sm-9 col-sm-offset-3">
		<div class="page-header">
	<h1>A .NET Developer Guide to XUnit Test Instrumentation with OpenTelemetry and Aspire Dashboard </h1>
</div>
<article>

	<div class="col-sm-10">

		<span class="post-date">
			
			June
			12th,
			
			2024
		</span>

	
	
	
	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	
	<div>
		<h5><a href="/dotnet/ai/2024/09/04/typical-rag-dotnet.html">Typical RAG Implementation Using Semantic Kernel, Kernel Memory, and Aspire in .NET <span class="label label-default">dotnet</span>  <span class="label label-default">opentelemetry</span>  <span class="label label-default">aspire</span> </a></h5>
	</div>
	
	
	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	
	<div>
		<h5><a href="/dotnet/aspire/2024/06/28/startup-dependencies-aspire.html">Managing Startup Dependencies in .NET Aspire <span class="label label-default">dotnet</span>  <span class="label label-default">aspnetcore</span>  <span class="label label-default">aspire</span> </a></h5>
	</div>
	
	
	

	

	
	

	

	
	<div>
		<h5><a href="/dotnet/aspire/2024/06/18/polyglot-persistance-with-aspire.html">Learn .NET Aspire by example: Polyglot persistence featuring PostgreSQL, Redis, MongoDB, and Elasticsearch <span class="label label-default">dotnet</span>  <span class="label label-default">aspnetcore</span>  <span class="label label-default">aspire</span> </a></h5>
	</div>
	
	
	

	

	
	

	

	

	

	
	

	

	
	<div>
		<h5><a href="/dotnet/opentelemetry/2024/06/07/test-instrumentation-with-otel-aspire.html">Automated Tests instrumentation via OpenTelemetry and Aspire Dashboard <span class="label label-default">dotnet</span>  <span class="label label-default">aspnetcore</span>  <span class="label label-default">opentelemetry</span>  <span class="label label-default">aspire</span> </a></h5>
	</div>
	
	
	
	

	<div class="article_body" style="margin-top: 30px;">
		<h2 id="tldr">TL;DR</h2>

<p>In this guide, we will explored how to leverage XUnit and OpenTelemetry to instrument .NET test projects. The process of setting up the <a href="https://www.nuget.org/packages/XUnit.Otel.Template" target="_blank" rel="noopener noreferrer">XUnit.Otel.Template</a> demonstrates the ease with which developers can start instrumenting their tests, making it accessible even for those new to OpenTelemetry or Aspire Dashboard.</p>

<p><strong>Source code</strong>: <a href="https://github.com/NikiforovAll/xunit-instrumentation-otel-template" target="_blank" rel="noopener noreferrer">https://github.com/NikiforovAll/xunit-instrumentation-otel-template</a></p>

<center>
    <img src="/assets/xunit-otel/blog-cover.png" style="margin: 15px;">
</center>

<p><em>Table of Contents:</em></p>

<ul>
  <li><a href="#tldr">TL;DR</a></li>
  <li><a href="#introduction">Introduction</a></li>
  <li><a href="#installation">Installation</a></li>
  <li>
<a href="#run-tests">Run Tests</a>
    <ul>
      <li><a href="#explore-the-code">Explore the code</a></li>
      <li><a href="#results-of-test-run">Results of Test Run</a></li>
      <li><a href="#metrics">Metrics</a></li>
    </ul>
  </li>
  <li><a href="#conclusion">Conclusion</a></li>
  <li><a href="#references">References</a></li>
</ul>

<h2 id="introduction">Introduction</h2>

<p>As discussed in my previous blog post - <a href="https://nikiforovall.github.io/dotnet/opentelemetry/2024/06/07/test-instrumentation-with-otel-aspire.html" target="_blank" rel="noopener noreferrer">Automated Tests Instrumentation via OpenTelemetry and Aspire Dashboard</a>, we can utilize OpenTelemetry and Aspire Dashboard to gain valuable insights into the execution of our tests. This allows us to collect and analyze data over time, enabling us to identify potential anomalies.</p>

<p>Considering the positive response from the community, I have taken the initiative to enhance the existing approach and create a reusable starter template for everyone to benefit from.</p>

<h2 id="installation">Installation</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ dotnet new <span class="nb">install </span>XUnit.Otel.Template::1.0.0
<span class="c"># The following template packages will be installed:</span>
<span class="c">#    XUnit.Otel.Template::1.0.0</span>
<span class="c"># Success: XUnit.Otel.Template::1.0.0 installed the following templates:</span>
<span class="c"># Template Name  Short Name  Language  Tags</span>
<span class="c"># -------------  ----------  --------  -------------------------</span>
<span class="c"># XUnit Otel     xunit-otel  [C#]      XUnit/Tests/OpenTelemetry</span>
</code></pre></div></div>

<p>Generate:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ dotnet new xunit-otel <span class="nt">-o</span> <span class="nv">$dev</span>/XUnitOtelExample01 <span class="nt">-n</span> XUnitOtelExample
<span class="c"># The template "XUnit Otel" was created successfully.</span>
</code></pre></div></div>

<h2 id="run-tests">Run Tests</h2>

<p>Now let’s navigate to the project directory and run test project with additional option (environment variable really) to include warmup trace. Warmup trace is a special trace that shows how much time it takes to configure dependencies:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ <span class="nv">XUNIT_OTEL_TRACE_WARMUP</span><span class="o">=</span><span class="nb">true </span>dotnet <span class="nb">test</span>
<span class="c"># Restore complete (1.2s)</span>
<span class="c"># You are using a preview version of .NET. See: https://aka.ms/dotnet-support-policy</span>
<span class="c">#   XUnitOtelExample succeeded (4.9s) → bin\Debug\net8.0\XUnitOtelExample.dll</span>
<span class="c">#   XUnitOtelExample test succeeded (2.8s)</span>

<span class="c"># Build succeeded in 9.2s</span>
<span class="c"># Test run succeeded. Total: 3 Failed: 0 Passed: 3 Skipped: 0, Duration: 2.8s</span>
</code></pre></div></div>

<p>Let’s navigate to <a href="http://localhost:18888/traces">http://localhost:18888/traces</a> to see the results of test execution.</p>

<p>☝️ Aspire Dashboard is automatically started based on <a href="https://dotnet.testcontainers.org/" target="_blank" rel="noopener noreferrer">Testcontainers</a> setup as part of <code class="language-plaintext highlighter-rouge">BaseFixture</code>.</p>

<center>
    <img src="/assets/xunit-otel/initial-traces.png" style="margin: 15px;">
</center>

<p>As you can see, there are two traces one for test run and one for warmup.</p>

<h3 id="explore-the-code">Explore the code</h3>

<p>Before we move further let’s explore the content of exemplary test suit.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="n">TracePerTestRun</span><span class="p">]</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">ExampleTests</span><span class="p">(</span><span class="n">BaseFixture</span> <span class="n">fixture</span><span class="p">)</span> <span class="p">:</span> <span class="nf">BaseContext</span><span class="p">(</span><span class="n">fixture</span><span class="p">)</span>
<span class="p">{</span>
    <span class="p">[</span><span class="n">Fact</span><span class="p">]</span>
    <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">WaitRandomTime_Success</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>

    <span class="p">[</span><span class="n">Fact</span><span class="p">]</span>
    <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">WaitRandomTime_ProducesSubActivity_Success</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>

    <span class="p">[</span><span class="n">Fact</span><span class="p">]</span>
    <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">WaitRandomTime_AsyncWait_Success</span><span class="p">()</span>
    <span class="p">{</span>
       <span class="c1">// ...</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p><strong>WaitRandomTime_Success</strong>: This test waits for a random duration between 100 and 500 milliseconds and then asserts that the operation completes successfully. Note, the special method called <code class="language-plaintext highlighter-rouge">Runner</code>. It is intended to wrap the asserted code so we can capture exceptions and enrich the traces with additional data such as exception message, trace, etc.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="n">Fact</span><span class="p">]</span>
<span class="k">public</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">WaitRandomTime_Success</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// Given</span>
    <span class="kt">int</span> <span class="n">waitFor</span> <span class="p">=</span> <span class="n">Random</span><span class="p">.</span><span class="n">Shared</span><span class="p">.</span><span class="nf">Next</span><span class="p">(</span><span class="m">100</span><span class="p">,</span> <span class="m">500</span><span class="p">);</span>
    <span class="n">TimeSpan</span> <span class="n">delay</span> <span class="p">=</span> <span class="n">TimeSpan</span><span class="p">.</span><span class="nf">FromMilliseconds</span><span class="p">(</span><span class="n">waitFor</span><span class="p">);</span>

    <span class="c1">// When</span>
    <span class="k">await</span> <span class="n">Task</span><span class="p">.</span><span class="nf">Delay</span><span class="p">(</span><span class="n">delay</span><span class="p">);</span>

    <span class="c1">// Then</span>
    <span class="nf">Runner</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="n">Assert</span><span class="p">.</span><span class="nf">True</span><span class="p">(</span><span class="k">true</span><span class="p">));</span>
<span class="p">}</span>
</code></pre></div></div>

<p><strong>WaitRandomTime_ProducesSubActivity_Success</strong>: Similar to the first, but it waits for a shorter random duration (between 50 and 250 milliseconds). It also starts a new activity named “SubActivity”, logs an event indicating a delay has been waited for, and sets a tag with the delay duration. The test asserts success after the wait. This example demonstrate how to add additional traces to test suit if needed.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="n">Fact</span><span class="p">]</span>
<span class="k">public</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">WaitRandomTime_ProducesSubActivity_Success</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// Given</span>
    <span class="k">using</span> <span class="nn">var</span> <span class="n">myActivity</span> <span class="p">=</span> <span class="n">BaseFixture</span><span class="p">.</span><span class="n">ActivitySource</span><span class="p">.</span><span class="nf">StartActivity</span><span class="p">(</span><span class="s">"SubActivity"</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">waitFor</span> <span class="p">=</span> <span class="n">Random</span><span class="p">.</span><span class="n">Shared</span><span class="p">.</span><span class="nf">Next</span><span class="p">(</span><span class="m">50</span><span class="p">,</span> <span class="m">250</span><span class="p">);</span>
    <span class="n">TimeSpan</span> <span class="n">delay</span> <span class="p">=</span> <span class="n">TimeSpan</span><span class="p">.</span><span class="nf">FromMilliseconds</span><span class="p">(</span><span class="n">waitFor</span><span class="p">);</span>

    <span class="c1">// When</span>
    <span class="k">await</span> <span class="n">Task</span><span class="p">.</span><span class="nf">Delay</span><span class="p">(</span><span class="n">delay</span><span class="p">);</span>
    <span class="n">myActivity</span><span class="p">?.</span><span class="nf">AddEvent</span><span class="p">(</span><span class="k">new</span><span class="p">(</span><span class="s">$"WaitedForDelay"</span><span class="p">));</span>
    <span class="n">myActivity</span><span class="p">?.</span><span class="nf">SetTag</span><span class="p">(</span><span class="s">"subA_activity:delay"</span><span class="p">,</span> <span class="n">waitFor</span><span class="p">);</span>

    <span class="c1">// Then</span>
    <span class="nf">Runner</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="n">Assert</span><span class="p">.</span><span class="nf">True</span><span class="p">(</span><span class="k">true</span><span class="p">));</span>
<span class="p">}</span>
</code></pre></div></div>

<p><strong>WaitRandomTime_AsyncWait_Success</strong>: This test is partially shown. Like the others, it waits for a random duration between 50 and 250 milliseconds then within a Runner method, waits for the delay again before asserting a condition that is always true. This demonstrates asynchronous <code class="language-plaintext highlighter-rouge">Runner</code> execution.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="n">Fact</span><span class="p">]</span>
<span class="k">public</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">WaitRandomTime_AsyncWait_Success</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// Given</span>
    <span class="kt">int</span> <span class="n">waitFor</span> <span class="p">=</span> <span class="n">Random</span><span class="p">.</span><span class="n">Shared</span><span class="p">.</span><span class="nf">Next</span><span class="p">(</span><span class="m">50</span><span class="p">,</span> <span class="m">250</span><span class="p">);</span>
    <span class="n">TimeSpan</span> <span class="n">delay</span> <span class="p">=</span> <span class="n">TimeSpan</span><span class="p">.</span><span class="nf">FromMilliseconds</span><span class="p">(</span><span class="n">waitFor</span><span class="p">);</span>

    <span class="c1">// When</span>
    <span class="k">await</span> <span class="n">Task</span><span class="p">.</span><span class="nf">Delay</span><span class="p">(</span><span class="n">delay</span><span class="p">);</span>

    <span class="c1">// Then</span>

    <span class="k">await</span> <span class="nf">Runner</span><span class="p">(</span><span class="k">async</span> <span class="p">()</span> <span class="p">=&gt;</span>
    <span class="p">{</span>
        <span class="k">await</span> <span class="n">Task</span><span class="p">.</span><span class="nf">Delay</span><span class="p">(</span><span class="n">delay</span><span class="p">);</span>

        <span class="n">Assert</span><span class="p">.</span><span class="nf">True</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="results-of-test-run">Results of Test Run</h3>

<p>Here is the result of trace output, as you can see, every test has it’s own trace and we can see how tests are executed sequentially by XUnit:</p>

<center>
    <img src="/assets/xunit-otel/test-run.png" style="margin: 15px;">
</center>

<p>Now, let’s modify the <code class="language-plaintext highlighter-rouge">WaitRandomTime_AsyncWait_Success</code> test to intentionally cause it to fail. This will allow us to observe how the test framework displays failed tests:</p>

<center>
    <img src="/assets/xunit-otel/trace-with-error.png" style="margin: 15px;">
</center>

<p>Below are the details of the test run. Failed tests are readily identifiable on the Aspire Dashboard, where each failed test is accompanied by an <em>Trace Event</em> with exception details. This event provides detailed insights into the reasons behind the test failure.</p>

<center>
    <img src="/assets/xunit-otel/trace-with-error-details.png" style="margin: 15px;">
</center>

<h3 id="metrics">Metrics</h3>

<p>These metrics highlight the execution time on a per-test and per-class basis, categorized by tags.</p>

<center>
    <img src="/assets/xunit-otel/metrics.png" style="margin: 15px;">
</center>

<p>The P50 percentile, also known as the median, represents the <strong>middle value</strong> of a dataset when it’s sorted in ascending order. In the context of test execution, the P50 percentile for execution time tells you that:</p>

<ul>
  <li><strong>50% of your tests complete faster than this time.</strong></li>
  <li><strong>50% of your tests complete slower than this time.</strong></li>
</ul>

<p>Here’s how you can use the P50 percentile for test execution:</p>

<p><strong>1. Performance Benchmark:</strong></p>

<ul>
  <li>The P50 provides a good representation of the “typical” test execution time.</li>
  <li>You can use it as a baseline to compare performance over time. For example, if your P50 increases significantly after a code change, it might indicate a performance regression.</li>
</ul>

<p><strong>2. Setting Realistic Expectations:</strong></p>

<ul>
  <li>Instead of focusing on the absolute fastest or slowest tests, the P50 gives you a realistic idea of how long most tests take to execute.</li>
</ul>

<p><strong>3. Identifying Areas for Improvement:</strong></p>

<ul>
  <li>While the P50 represents the median, a large difference between the P50 and higher percentiles (like P90 or P95) indicates a wide spread in execution times.</li>
  <li>This suggests that some tests are significantly slower than others, and you might want to investigate those outliers for potential optimizations.</li>
</ul>

<p><strong>Example:</strong></p>

<p>Let’s say your test suite has a P50 execution time of 200 milliseconds. This means:</p>

<ul>
  <li>Half of your tests finish in under 200 milliseconds.</li>
  <li>Half of your tests take longer than 200 milliseconds.</li>
</ul>

<p><strong>In summary,</strong> the P50 percentile provides a valuable metric for understanding the typical performance of your tests and identifying areas for optimization. It helps you set realistic expectations, track performance trends, and make informed decisions about your testing process.</p>

<h2 id="conclusion">Conclusion</h2>

<p>In this guide, we’ve explored how to leverage XUnit and OpenTelemetry to instrument our .NET test projects, providing a deeper insight into our test executions with the Aspire Dashboard. By integrating these tools, developers can gain valuable metrics and traces that illuminate the performance and behavior of tests in a way that traditional testing frameworks cannot match.</p>

<p>The process of setting up the <code class="language-plaintext highlighter-rouge">XUnit.Otel.Template</code> demonstrates the ease with which developers can start instrumenting their tests, making it accessible even for those new to OpenTelemetry or Aspire Dashboard. The examples provided show not only how to implement basic test instrumentation but also how to enrich our tests with additional data, such as custom activities and events, to gain more detailed insights.</p>

<p>The ability to visualize test executions and metrics on the <em>Aspire Dashboard</em> transforms the way we perceive and interact with our test suites. It allows us to quickly identify and address failures, understand performance bottlenecks, and improve the reliability and efficiency of our tests over time.</p>

<p>As we continue to evolve our testing strategies, the integration of OpenTelemetry and Aspire Dashboard with XUnit represents a significant step forward in achieving more observable, reliable, and insightful test suites. This guide serves as a starting point for developers looking to enhance their testing practices with these powerful tools.</p>

<h2 id="references">References</h2>

<ul>
  <li><a href="https://github.com/NikiforovAll/xunit-instrumentation-otel-template" target="_blank" rel="noopener noreferrer">https://github.com/NikiforovAll/xunit-instrumentation-otel-template</a></li>
  <li><a href="https://nikiforovall.github.io/dotnet/opentelemtry/2024/06/07/test-instrumentation-with-otel-aspire.html" target="_blank" rel="noopener noreferrer">https://nikiforovall.github.io/dotnet/opentelemtry/2024/06/07/test-instrumentation-with-otel-aspire.html</a></li>
</ul>

	</div>

	

	
	<ul class="list-inline">
		<li>
<i class="fa-solid fa-bookmark"></i> Topics:</li>
		
		
		
		<li>
			<a href="/topics.html#dotnet-cat-ref">
				dotnet <span>(58)</span>
			</a>
			 ·
		</li>
		
		<li>
			<a href="/topics.html#opentelemetry-cat-ref">
				opentelemetry <span>(2)</span>
			</a>
			 ·
		</li>
		
		
		
		
		
		<li>
			<a href="/topics.html#dotnet-tag-ref">
				dotnet <span>(63)</span>
			</a>
			 ·
		</li>
		
		<li>
			<a href="/topics.html#aspnetcore-tag-ref">
				aspnetcore <span>(24)</span>
			</a>
			 ·
		</li>
		
		<li>
			<a href="/topics.html#opentelemetry-tag-ref">
				opentelemetry <span>(4)</span>
			</a>
			 ·
		</li>
		
		<li>
			<a href="/topics.html#aspire-tag-ref">
				aspire <span>(20)</span>
			</a>
			
		</li>
		
		
		
	</ul>
	

	<hr>

	<div>
		<section class="share col-sm-6">
			<h4 class="section-title">Share Post</h4>
			<a class="btn btn-default btn-sm twitter" href="http://x.com/share?&amp;via=nikiforovall" onclick="window.open(this.href, 'x-share', 'width=550,height=235');return false;" target="_blank" rel="noopener noreferrer">
				<i class="fa-brands fa-x-twitter fa-lg"></i>
				X
			</a>
		</section>

		<section class="col-sm-6 author">
			<img src="//www.gravatar.com/avatar/e86fa0938976c38907a302ecb208f011" class="img-rounded author-image">
			<h4 class="section-title author-name">Oleksii Nikiforov</h4>
			<p class="author-bio">Jibber-jabbering about programming and IT.</p>
		</section>
	</div>

	<div class="clearfix"></div>

	<ul class="pager">
		
		<li class="previous"><a href="/dotnet/opentelemetry/2024/06/07/test-instrumentation-with-otel-aspire.html" title="Automated Tests instrumentation via OpenTelemetry and Aspire Dashboard">←
				Previous</a></li>
		
		
		<li class="next">
<a href="/dotnet/aspire/2024/06/18/polyglot-persistance-with-aspire.html" title="Learn .NET Aspire by example: Polyglot persistence featuring PostgreSQL, Redis, MongoDB, and Elasticsearch">Next →</a>
		</li>
		
	</ul>

	<hr>
	</div>

	<div class="col-sm-2 sidebar-2">

	</div>

</article>
<div class="clearfix"></div>



    
    <script src="https://utteranc.es/client.js" repo="NikiforovAll/nikiforovall.github.io" issue-term="pathname" label="Blog" theme="preferred-color-scheme" crossorigin="anonymous" async>
    </script>





		<footer>
			<hr>
			<p>
				© 2025 Oleksii Nikiforov with <a href="http://jekyllrb.com/" target="_blank" rel="noopener noreferrer">Jekyll</a>. Theme: <a href="https://github.com/dbtek/dbyll" target="_blank" rel="noopener noreferrer">dbyll</a> by dbtek.
			</p>
		</footer>
	</div>

	<script type="text/javascript" src="/assets/resources/jquery/jquery.min.js"></script>
	<script type="text/javascript" src="/assets/resources/bootstrap/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="/assets/js/app.js"></script>
	<script src="https://unpkg.com/lunr/lunr.js"></script>
	<script type="text/javascript" src="/assets/js/search.js"></script>
	
		<script type="text/javascript" src="https://unpkg.com/mermaid@10.9.0/dist/mermaid.min.js">
</script>
<script>
$(document).ready(function() {
    mermaid.initialize({
        theme: 'forest'
    });
});
</script>

	
</body>
</html>



<!-- Asynchronous Google Analytics snippet -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-164555539-1', 'auto');
  ga('send', 'pageview');
</script>

