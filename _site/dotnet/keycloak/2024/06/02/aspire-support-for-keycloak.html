<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Using Keycloak in .NET Aspire projects | N+1 Blog</title>

	<!-- Meta Description -->
	
	<meta name="description" content="Learn how to run Keycloak installation via Aspire">
	

	<meta name="author" content="Oleksii Nikiforov">

	<!-- Canonical URL -->
	<link rel="canonical" href="http://localhost:4000/dotnet/keycloak/2024/06/02/aspire-support-for-keycloak.html">

	<!-- Open Graph -->
	<meta property="og:title" content="Using Keycloak in .NET Aspire projects">
	<meta property="og:description" content="Learn how to run Keycloak installation via Aspire">
	<meta property="og:url" content="http://localhost:4000/dotnet/keycloak/2024/06/02/aspire-support-for-keycloak.html">
	<meta property="og:site_name" content="N+1 Blog">
	<meta property="og:type" content="article">
	
	<meta property="article:published_time" content="2024-06-02T00:00:00+03:00">
	
	<meta property="og:image" content="http://localhost:4000/assets/media/default-post-image.png">

	<!-- Twitter Card -->
	<meta name="twitter:card" content="summary_large_image">
	<meta name="twitter:site" content="@nikiforovall">
	<meta name="twitter:title" content="Using Keycloak in .NET Aspire projects">
	<meta name="twitter:description" content="Learn how to run Keycloak installation via Aspire">
	<meta name="twitter:image" content="http://localhost:4000/assets/media/default-post-image.png">

	<!-- Enable responsive viewport -->
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
	<!--[if lt IE 9]>
	<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->

	<!-- Le styles -->
	<link href="/assets/resources/bootstrap/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
	<link href="/assets/resources/syntax/syntax.css" rel="stylesheet">
	<link href="/assets/css/style.css" rel="stylesheet">

	<!-- Search Feature Styles -->
	<style>
		.layout-page .search-trigger { position: fixed; top: 45px; right: 100px; z-index: 1000; display: flex; align-items: center; gap: 10px; padding: 6px 12px; background: #f5f5f5; border: 1px solid #ddd; border-radius: 4px; cursor: pointer; min-width: 220px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); transition: all 0.15s ease; height: 34px; box-sizing: border-box; }
		.layout-post .search-trigger { position: fixed; top: 45px; right: 100px; z-index: 1000; display: flex; align-items: center; justify-content: center; padding: 0; background: #f5f5f5; border: 1px solid #ddd; border-radius: 4px; cursor: pointer; width: 34px; height: 34px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); transition: all 0.15s ease; box-sizing: border-box; }
		.search-trigger:hover { background: #ebebeb; border-color: #c0c0c0; box-shadow: 0 2px 5px rgba(0,0,0,0.08); }
		.search-icon { color: #666; font-size: 14px; display: flex; align-items: center; }
		.search-placeholder { flex: 1; color: #999; font-size: 14px; user-select: none; }
		.search-keybind { display: flex; gap: 4px; align-items: center; }
		.search-key { font-family: 'Courier New', monospace; font-size: 11px; padding: 2px 6px; background: #e0e0e0; border: 1px solid #ccc; border-bottom: 2px solid #bbb; border-radius: 3px; color: #333; line-height: 1.2; box-shadow: 0 1px 1px rgba(0,0,0,0.1); }
		.layout-post .search-placeholder { display: none; }
		.layout-post .search-keybind { display: none; }
		.search-modal { position: fixed; top: 0; left: 0; right: 0; bottom: 0; z-index: 10000; display: none; align-items: flex-start; justify-content: center; padding-top: 10vh; }
		.search-modal.open { display: flex; animation: fadeIn 0.2s ease; }
		@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
		.search-backdrop { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.5); backdrop-filter: blur(2px); }
		.search-modal-container { position: relative; width: 90%; max-width: 600px; background: white; border-radius: 8px; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3); overflow: hidden; }
		.search-input-container { display: flex; align-items: center; padding: 16px 20px; border-bottom: 1px solid #e0e0e0; gap: 12px; }
		.search-modal-icon { color: #666; font-size: 18px; }
		.search-modal-input { flex: 1; border: none; outline: none; font-size: 16px; color: #333; background: transparent; }
		.search-modal-input::placeholder { color: #999; }
		.search-close-btn { background: transparent; border: none; color: #999; font-size: 18px; cursor: pointer; padding: 4px 8px; border-radius: 4px; transition: all 0.15s ease; }
		.search-close-btn:hover { background: #f0f0f0; color: #333; }
		.search-results { max-height: 60vh; overflow-y: auto; padding: 8px; }
		.search-hint { padding: 40px 20px; text-align: center; color: #999; font-size: 14px; }
		.search-result-item { padding: 12px 16px; border-radius: 6px; cursor: pointer; transition: background-color 0.15s ease; border: 2px solid transparent; margin-bottom: 4px; }
		.search-result-item:hover { background: #f5f5f5; }
		.search-result-item.selected { background: #e8f4f8; border-color: #4a90e2; }
		.search-footer { display: flex; justify-content: center; gap: 20px; padding: 12px 20px; border-top: 1px solid #e0e0e0; background: #fafafa; font-size: 12px; color: #666; }
		.search-footer kbd { font-family: 'Courier New', monospace; font-size: 11px; padding: 2px 5px; background: white; border: 1px solid #ddd; border-radius: 3px; color: #333; box-shadow: 0 1px 1px rgba(0,0,0,0.1); }
		@media (max-width: 768px) { .layout-page .search-trigger, .layout-post .search-trigger { display: none; } .search-modal { padding-top: 5vh; } .search-modal-container { width: 95%; max-width: none; margin: 0 10px; } .search-results { max-height: 50vh; } .search-footer { flex-wrap: wrap; gap: 10px; } }
	</style>

	<!-- Le fav and touch icons -->
	<!-- Update these with your own images
	<link rel="shortcut icon" href="images/favicon.ico">
	<link rel="apple-touch-icon" href="images/apple-touch-icon.png">
	<link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
	-->
	<link rel="shortcut icon" href="/assets/media/favicon.ico">

	<link rel="alternate" type="application/rss+xml" title="" href="http://localhost:4000/feed.xml">

	
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Using Keycloak in .NET Aspire projects",
  
  
  "description": "Learn how to run Keycloak installation via Aspire",
  
  "image": ["http://localhost:4000/assets/media/default-post-image.png"],
  "datePublished": "2024-06-02T00:00:00+03:00",
  "dateModified": "2024-06-02T00:00:00+03:00",
  "author": {
    "@type": "Person",
    "name": "Oleksii Nikiforov",
    "url": "http://localhost:4000/about.html",
    "sameAs": [
      "https://github.com/nikiforovAll",
      "https://twitter.com/nikiforovall",
      "https://www.linkedin.com/in/nikiforov-oleksii",
      "https://t.me/nikiforovallblog"
    ]
  },
  "publisher": {
    "@type": "Person",
    "name": "Oleksii Nikiforov",
    "logo": {
      "@type": "ImageObject",
      "url": "https://www.gravatar.com/avatar/e86fa0938976c38907a302ecb208f011?s=200"
    }
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://localhost:4000/dotnet/keycloak/2024/06/02/aspire-support-for-keycloak.html"
  },
  
  "articleSection": "dotnet",
  
  
  "keywords": "dotnet, aspnetcore, keycloak, aspire",
  
  "inLanguage": "en-US"
}
</script>


</head>

<body class="layout-post">
	<nav class="navbar navbar-default visible-xs" role="navigation">
		<!-- Brand and toggle get grouped for better mobile display -->
		<div class="navbar-header">
			<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			
			<a type="button" class="navbar-toggle nav-link" href="http://github.com/nikiforovAll" target="_blank" rel="noopener noreferrer noopener noreferrer">
				<i class="fa-brands fa-github"></i>
			</a>
			
			
			<a type="button" class="navbar-toggle nav-link" href="http://x.com/nikiforovall" target="_blank" rel="noopener noreferrer noopener noreferrer">
				<i class="fa-brands fa-x-twitter"></i>
			</a>
			
			
			<a type="button" class="navbar-toggle nav-link" href="mailto:alexey.nikiforovall@gmail.com">
				<i class="fa-solid fa-envelope"></i>
			</a>
			
			<a class="navbar-brand" href="/">
				<img src="//www.gravatar.com/avatar/e86fa0938976c38907a302ecb208f011?s=35" class="img-circle">
				N+1 Blog
			</a>
		</div>

		<!-- Collect the nav links, forms, and other content for toggling -->
		<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
			<ul class="nav navbar-nav">
				<li class="active"><a href="/">Home</a></li>
				<li><a href="/topics.html">Topics</a></li>
				<li><a href="/about.html">About</a></li>
			</ul>
		</div>
<!-- /.navbar-collapse -->
	</nav>

	<!-- nav-menu-dropdown -->
	<div class="btn-group hidden-xs" id="nav-menu">
		<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
			<i class="fa-solid fa-bars"></i>
		</button>
		<ul class="dropdown-menu" role="menu">
			<li><a href="/"><i class="fa-solid fa-home"></i>Home</a></li>
			<li><a href="/topics.html"><i class="fa-solid fa-bookmark"></i>Topics</a></li>
			<li><a href="/about.html"><i class="fa-solid fa-pencil"></i>About</a></li>
			<li class="divider">
			<li><a href="#"><i class="fa-solid fa-arrow-up"></i>Top of Page</a></li>
		</ul>
	</div>

	<!-- Search Control -->
	<button id="search-trigger" class="search-trigger" type="button" aria-label="Open search">
		<span class="search-icon"><i class="fa-solid fa-search"></i></span>
		<span class="search-placeholder">Search</span>
		<div class="search-keybind">
			<kbd class="search-key" id="search-modifier">ctrl</kbd>
			<kbd class="search-key">K</kbd>
		</div>
	</button>

	<!-- Search Modal -->
	<div id="search-modal" class="search-modal">
		<div class="search-backdrop"></div>
		<div class="search-modal-container">
			<div class="search-input-container">
				<i class="fa-solid fa-search search-modal-icon"></i>
				<input type="text" id="search-input" class="search-modal-input" placeholder="Search blog posts..." autocomplete="off">
				<button id="search-close" class="search-close-btn" title="Close (ESC)">
					<i class="fa-solid fa-times"></i>
				</button>
			</div>
			<div id="search-results" class="search-results">
				<div class="search-hint">Type at least 2 characters to search...</div>
			</div>
			<div class="search-footer">
				<span><kbd>‚Üë</kbd> <kbd>‚Üì</kbd> to navigate</span>
				<span><kbd>‚Üµ</kbd> to select</span>
				<span><kbd>ESC</kbd> to close</span>
			</div>
		</div>
	</div>

	<div class="col-sm-3 sidebar hidden-xs" style="">
		<!-- sidebar.html -->
<header class="sidebar-header" role="banner">
	<a href="/" class="profile-link">
		<img src="//www.gravatar.com/avatar/e86fa0938976c38907a302ecb208f011?s=150" class="img-circle profile-image">
		<div class="profile-accent"></div>
	</a>
	<h3 class="title">
        <a href="/">N+1 Blog</a>
    </h3>
</header>


<div id="bio" class="text-center">
	Jibber-jabbering about programming and IT.
</div>


<div id="contact-list" class="text-center">
	<ul class="list-unstyled list-inline">
		
		<li>
			<a class="btn btn-default btn-sm" href="https://github.com/nikiforovAll" target="_blank" rel="noopener noreferrer noopener noreferrer">
				<i class="fa-brands fa-github fa-xl"></i>
			</a>
		</li>
		
		
		<li>
			<a class="btn btn-default btn-sm" href="https://x.com/nikiforovall" target="_blank" rel="noopener noreferrer noopener noreferrer">
				<i class="fa-brands fa-x-twitter fa-xl"></i>
			</a>
		</li>
		
		
		<li>
			<a class="btn btn-default btn-sm" href="https://t.me/nikiforovallblog" target="_blank" rel="noopener noreferrer noopener noreferrer">
				<i class="fa-brands fa-telegram fa-xl"></i>
			</a>
		</li>
		
		
		<li>
			<a class="btn btn-default btn-sm" href="https://linkedin.com/in/nikiforov-oleksii" target="_blank" rel="noopener noreferrer noopener noreferrer">
				<i class="fa-brands fa-linkedin fa-xl"></i>
			</a>
		</li>
		
	</ul>
	<ul id="contact-list-secondary" class="list-unstyled list-inline">
		
		<li>
			<a class="btn btn-default btn-sm" href="mailto:alexey.nikiforovall@gmail.com">
				<i class="fa-solid fa-envelope fa-xl"></i>
			</a>
		</li>
		
		<li>
			<a class="btn btn-default btn-sm" href="/feed.xml" target="_blank" rel="noopener noreferrer">
				<i class="fa-solid fa-rss fa-xl"></i>
			</a>
		</li>
	</ul>
</div>
<!-- sidebar.html end -->

	</div>

	<div class="col-sm-9 col-sm-offset-3">
		<div class="page-header">
	<h1>Using Keycloak in .NET Aspire projects </h1>
</div>
<article>

	<div class="col-sm-10">

		<span class="post-date">
			
			June
			2nd,
			
			2024
		</span>

	
	
	
	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	
	<div>
		<h5><a href="/dotnet/aspire/2024/06/28/startup-dependencies-aspire.html">Managing Startup Dependencies in .NET Aspire <span class="label label-default">dotnet</span>  <span class="label label-default">aspnetcore</span>  <span class="label label-default">aspire</span> </a></h5>
	</div>
	
	
	

	

	
	

	

	
	<div>
		<h5><a href="/dotnet/aspire/2024/06/18/polyglot-persistance-with-aspire.html">Learn .NET Aspire by example: Polyglot persistence featuring PostgreSQL, Redis, MongoDB, and Elasticsearch <span class="label label-default">dotnet</span>  <span class="label label-default">aspnetcore</span>  <span class="label label-default">aspire</span> </a></h5>
	</div>
	
	
	

	

	
	

	

	
	<div>
		<h5><a href="/dotnet/opentelemetry/2024/06/12/developer-guide-to-xunit-otel.html">A .NET Developer Guide to XUnit Test Instrumentation with OpenTelemetry and Aspire Dashboard <span class="label label-default">dotnet</span>  <span class="label label-default">aspnetcore</span>  <span class="label label-default">aspire</span> </a></h5>
	</div>
	
	
	

	

	
	

	

	
	<div>
		<h5><a href="/dotnet/opentelemetry/2024/06/07/test-instrumentation-with-otel-aspire.html">Automated Tests instrumentation via OpenTelemetry and Aspire Dashboard <span class="label label-default">dotnet</span>  <span class="label label-default">aspnetcore</span>  <span class="label label-default">aspire</span> </a></h5>
	</div>
	
	
	
	

	<div class="article_body" style="margin-top: 30px;">
		<h2 id="tldr">TL;DR</h2>

<p>You can use <a href="https://www.nuget.org/packages/Keycloak.AuthServices.Templates/" target="_blank" rel="noopener noreferrer">Keycloak.AuthServices.Templates</a> to add Keycloak support for .NET Aspire projects. See the docs for more details - <a href="https://nikiforovall.github.io/keycloak-authorization-services-dotnet/devex/aspire.html" target="_blank" rel="noopener noreferrer">Keycloak.AuthServices/Aspire Support</a>.</p>

<p>Source code: <a href="https://github.com/NikiforovAll/keycloak-aspire-starter-template" target="_blank" rel="noopener noreferrer">https://github.com/NikiforovAll/keycloak-aspire-starter-template</a></p>

<ul>
  <li><a href="#tldr">TL;DR</a></li>
  <li>
<a href="#introduction">Introduction</a>
    <ul>
      <li><a href="#scaffold-a-solution">Scaffold a solution</a></li>
      <li><a href="#run-it">Run it</a></li>
    </ul>
  </li>
  <li><a href="#code-explained">Code Explained</a></li>
  <li><a href="#conclusion">Conclusion</a></li>
  <li><a href="#references">References</a></li>
</ul>

<h2 id="introduction">Introduction</h2>

<p>From the official <a href="https://learn.microsoft.com/en-us/dotnet/aspire/get-started/aspire-overview" target="_blank" rel="noopener noreferrer">docs</a>:</p>

<blockquote>
  <p>.NET Aspire is designed to improve the experience of building .NET cloud-native apps. It provides a consistent, opinionated set of tools and patterns that help you build and run distributed apps.</p>
</blockquote>

<p>Personally, I‚Äôm a big fan of Aspire because it enables great developer experience and productivity. I recommend trying it on your own üöÄ</p>

<p>This article will show you how to get started with Keycloak and Aspire. It is based on <a href="https://www.nuget.org/packages/Keycloak.AuthServices.Templates" target="_blank" rel="noopener noreferrer">Keycloak.AuthServices.Templates</a> template. Templates make it really easy to get started.</p>

<p>üí°Here is a basic example of how the integration looks like:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">var</span> <span class="n">builder</span> <span class="p">=</span> <span class="n">DistributedApplication</span><span class="p">.</span><span class="nf">CreateBuilder</span><span class="p">(</span><span class="n">args</span><span class="p">);</span>

<span class="kt">var</span> <span class="n">keycloak</span> <span class="p">=</span> <span class="n">builder</span>
    <span class="p">.</span><span class="nf">AddKeycloakContainer</span><span class="p">(</span><span class="s">"keycloak"</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">WithDataVolume</span><span class="p">();</span>

<span class="kt">var</span> <span class="n">realm</span> <span class="p">=</span> <span class="n">keycloak</span><span class="p">.</span><span class="nf">AddRealm</span><span class="p">(</span><span class="s">"Test"</span><span class="p">);</span>

<span class="n">builder</span><span class="p">.</span><span class="n">AddProject</span><span class="p">&lt;</span><span class="n">Projects</span><span class="p">.</span><span class="n">Api</span><span class="p">&gt;(</span><span class="s">"api"</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">WithReference</span><span class="p">(</span><span class="n">realm</span><span class="p">);</span>

<span class="n">builder</span><span class="p">.</span><span class="nf">Build</span><span class="p">().</span><span class="nf">Run</span><span class="p">();</span>
</code></pre></div></div>

<h3 id="scaffold-a-solution">Scaffold a solution</h3>

<p>Install a templates pack:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ dotnet new <span class="nb">install </span>Keycloak.AuthServices.Templates
<span class="c"># The following template packages will be installed:</span>
<span class="c">#    Keycloak.AuthServices.Templates::2.5.0</span>
<span class="c"># Success: Keycloak.AuthServices.Templates::2.5.0 installed the following templates:</span>
<span class="c"># Template Name            Short Name               Language  Tags</span>
<span class="c"># -----------------------  -----------------------  --------  -------------------------------------</span>
<span class="c"># Keycloak Aspire Starter  keycloak-aspire-starter  [C#]      Common/.NET Aspire/Cloud/API/Keycloak</span>
<span class="c"># Keycloak WebApi          keycloak-webapi          [C#]      Common/API/Keycloak</span>
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ dotnet new keycloak-aspire-starter <span class="nt">-o</span> <span class="nv">$dev</span>/keycloak-aspire-starter-template
<span class="c"># The template "Keycloak Aspire Starter" was created successfully.</span>
</code></pre></div></div>

<p>Here is what was generated:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ tre
<span class="nb">.</span>
‚îú‚îÄ‚îÄ .gitignore
‚îú‚îÄ‚îÄ Api
‚îÇ   ‚îú‚îÄ‚îÄ Api.csproj
‚îÇ   ‚îú‚îÄ‚îÄ Extensions.OpenApi.cs
‚îÇ   ‚îú‚îÄ‚îÄ Program.cs
‚îÇ   ‚îú‚îÄ‚îÄ Properties
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ launchSettings.json
‚îÇ   ‚îú‚îÄ‚îÄ appsettings.Development.json
‚îÇ   ‚îî‚îÄ‚îÄ appsettings.json
‚îú‚îÄ‚îÄ AppHost
‚îÇ   ‚îú‚îÄ‚îÄ AppHost.csproj
‚îÇ   ‚îú‚îÄ‚îÄ KeycloakConfiguration
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Test-realm.json
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Test-users-0.json
‚îÇ   ‚îú‚îÄ‚îÄ Program.cs
‚îÇ   ‚îú‚îÄ‚îÄ Properties
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ launchSettings.json
‚îÇ   ‚îú‚îÄ‚îÄ appsettings.Development.json
‚îÇ   ‚îî‚îÄ‚îÄ appsettings.json
‚îú‚îÄ‚îÄ Directory.Build.props
‚îú‚îÄ‚îÄ Directory.Packages.props
‚îú‚îÄ‚îÄ README.md
‚îú‚îÄ‚îÄ ServiceDefaults
‚îÇ   ‚îú‚îÄ‚îÄ Extensions.cs
‚îÇ   ‚îî‚îÄ‚îÄ ServiceDefaults.csproj
‚îú‚îÄ‚îÄ global.json
‚îî‚îÄ‚îÄ keycloak-aspire-starter-template.sln
</code></pre></div></div>

<h3 id="run-it">Run it</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ dotnet run <span class="nt">--project</span> ./AppHost/
<span class="c"># Building...</span>
<span class="c"># info: Aspire.Hosting.DistributedApplication[0]</span>
<span class="c">#       Aspire version: 8.0.1+a6e341ebbf956bbcec0dda304109815fcbae70c9</span>
<span class="c"># info: Aspire.Hosting.DistributedApplication[0]</span>
<span class="c">#       Distributed application starting.</span>
<span class="c"># info: Aspire.Hosting.DistributedApplication[0]</span>
<span class="c">#       Application host directory is: C:\Users\Oleksii_Nikiforov\dev\keycloak-aspire-starter-template\AppHost</span>
<span class="c"># info: Aspire.Hosting.DistributedApplication[0]</span>
<span class="c">#       Now listening on: http://localhost:15056</span>
<span class="c"># info: Aspire.Hosting.DistributedApplication[0]</span>
<span class="c">#       Distributed application started. Press Ctrl+C to shut down.</span>
</code></pre></div></div>

<p>Here are resources from Aspire Dashboard:</p>

<center>
    <img src="/assets/keycloak-aspire/dashboard-resources.png" style="margin: 15px;">
</center>

<p>As you can see, there is a <code class="language-plaintext highlighter-rouge">quay.io/keycloak/keycloak:24.0.3</code> container running. It is available on your local machine: <a href="http://localhost:8080/">http://localhost:8080/</a>. Use <code class="language-plaintext highlighter-rouge">admin:admin</code> credentials.</p>

<p>The template project was generated with exemplary import files. It imports <em>Test</em> realm, adds <em>workspaces-client</em>, and seeds test users:</p>

<center>
    <img src="/assets/keycloak-aspire/test-realm.png" style="margin: 15px;">
</center>

<p>Now, we can open Swagger UI and retrieve an access token. Note, imported realm is configured to support <a href="https://oauth.net/2/grant-types/implicit/" target="_blank" rel="noopener noreferrer">Implicit Flow</a>. We can use it during the development process as demonstrated below.</p>

<center>
    <img src="/assets/keycloak-aspire/auth-swagger-ui.png" width="100%" style="margin: 15px;">
</center>

<p>To invoke the API you can use Swagger UI or other HTTP tool of your choice. Here is an example of how to use <code class="language-plaintext highlighter-rouge">cURL</code>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-X</span> <span class="s1">'GET'</span> <span class="se">\</span>
  <span class="s1">'https://localhost:51492/hello'</span> <span class="se">\</span>
  <span class="nt">-H</span> <span class="s1">'accept: text/plain'</span> <span class="se">\</span>
  <span class="nt">-H</span> <span class="s1">'Authorization: Bearer &lt;AUTH_TOKEN&gt;'</span>

<span class="c"># Hello World!</span>
</code></pre></div></div>

<h2 id="code-explained">Code Explained</h2>

<p>Basically, to setup Keycloak installation with Aspire we need to setup two things:</p>

<ol>
  <li>Add Keycloak Resource to Aspire <code class="language-plaintext highlighter-rouge">AppHost</code>.</li>
  <li>Configure Web API to target Keycloak installation</li>
</ol>

<p>Here is how to add Keycloak as resource to Aspire:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// AppHost/Program.cs</span>
<span class="kt">var</span> <span class="n">builder</span> <span class="p">=</span> <span class="n">DistributedApplication</span><span class="p">.</span><span class="nf">CreateBuilder</span><span class="p">(</span><span class="n">args</span><span class="p">);</span>

<span class="kt">var</span> <span class="n">keycloak</span> <span class="p">=</span> <span class="n">builder</span>
    <span class="p">.</span><span class="nf">AddKeycloakContainer</span><span class="p">(</span><span class="s">"keycloak"</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">WithDataVolume</span><span class="p">()</span>
    <span class="p">.</span><span class="nf">WithImport</span><span class="p">(</span><span class="s">"./KeycloakConfiguration/Test-realm.json"</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">WithImport</span><span class="p">(</span><span class="s">"./KeycloakConfiguration/Test-users-0.json"</span><span class="p">);</span>

<span class="kt">var</span> <span class="n">realm</span> <span class="p">=</span> <span class="n">keycloak</span><span class="p">.</span><span class="nf">AddRealm</span><span class="p">(</span><span class="s">"Test"</span><span class="p">);</span>

<span class="n">builder</span><span class="p">.</span><span class="n">AddProject</span><span class="p">&lt;</span><span class="n">Projects</span><span class="p">.</span><span class="n">Api</span><span class="p">&gt;(</span><span class="s">"api"</span><span class="p">).</span><span class="nf">WithReference</span><span class="p">(</span><span class="n">keycloak</span><span class="p">).</span><span class="nf">WithReference</span><span class="p">(</span><span class="n">realm</span><span class="p">);</span>

<span class="n">builder</span><span class="p">.</span><span class="nf">Build</span><span class="p">().</span><span class="nf">Run</span><span class="p">();</span>
</code></pre></div></div>

<p>The code above does the following:</p>

<ol>
  <li>Starts a Keycloak Instance</li>
  <li>Imports realm and test users</li>
  <li>Reference to Keycloak adds Keycloak to service discovery</li>
  <li>Reference to Realm adds <em>Keycloak__Realm</em> and <em>Keycloak__AuthServerUrl</em> environment variables.</li>
</ol>

<p>And here is how to configure <code class="language-plaintext highlighter-rouge">Api</code> to integrated with Keycloak and use <em>workspaces-client</em>:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Api/Program.cs</span>
<span class="k">using</span> <span class="nn">Api</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Keycloak.AuthServices.Authentication</span><span class="p">;</span>

<span class="kt">var</span> <span class="n">builder</span> <span class="p">=</span> <span class="n">WebApplication</span><span class="p">.</span><span class="nf">CreateBuilder</span><span class="p">(</span><span class="n">args</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">services</span> <span class="p">=</span> <span class="n">builder</span><span class="p">.</span><span class="n">Services</span><span class="p">;</span>
<span class="kt">var</span> <span class="n">configuration</span> <span class="p">=</span> <span class="n">builder</span><span class="p">.</span><span class="n">Configuration</span><span class="p">;</span>

<span class="n">builder</span><span class="p">.</span><span class="nf">AddServiceDefaults</span><span class="p">();</span>
<span class="n">services</span><span class="p">.</span><span class="nf">AddApplicationOpenApi</span><span class="p">(</span><span class="n">configuration</span><span class="p">);</span>

<span class="n">services</span><span class="p">.</span><span class="nf">AddKeycloakWebApiAuthentication</span><span class="p">(</span>
    <span class="n">configuration</span><span class="p">,</span>
    <span class="n">options</span> <span class="p">=&gt;</span>
    <span class="p">{</span>
        <span class="n">options</span><span class="p">.</span><span class="n">Audience</span> <span class="p">=</span> <span class="s">"workspaces-client"</span><span class="p">;</span>
        <span class="n">options</span><span class="p">.</span><span class="n">RequireHttpsMetadata</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">);</span>
<span class="n">services</span><span class="p">.</span><span class="nf">AddAuthorization</span><span class="p">();</span>

<span class="kt">var</span> <span class="n">app</span> <span class="p">=</span> <span class="n">builder</span><span class="p">.</span><span class="nf">Build</span><span class="p">();</span>

<span class="n">app</span><span class="p">.</span><span class="nf">UseHttpsRedirection</span><span class="p">();</span>

<span class="n">app</span><span class="p">.</span><span class="nf">UseApplicationOpenApi</span><span class="p">();</span>

<span class="n">app</span><span class="p">.</span><span class="nf">UseAuthentication</span><span class="p">();</span>
<span class="n">app</span><span class="p">.</span><span class="nf">UseAuthorization</span><span class="p">();</span>

<span class="n">app</span><span class="p">.</span><span class="nf">MapGet</span><span class="p">(</span><span class="s">"/hello"</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="s">"Hello World!"</span><span class="p">).</span><span class="nf">RequireAuthorization</span><span class="p">();</span>

<span class="n">app</span><span class="p">.</span><span class="nf">Run</span><span class="p">();</span>
</code></pre></div></div>

<h2 id="conclusion">Conclusion</h2>

<p>The integration of Keycloak with .NET Aspire projects provides a first class support for building distributed, cloud native systems. By leveraging the <code class="language-plaintext highlighter-rouge">Keycloak.AuthServices.Templates</code> template, developers can easily scaffold a solution and configure their APIs to work with Keycloak.</p>

<hr>

<p>üôå <code class="language-plaintext highlighter-rouge">Keycloak.AuthServices.Templates</code> is under development. Please, feel free to submit PRs. <a href="https://github.com/nikiforovall/keycloak-authorization-services-dotnet" target="_blank" rel="noopener noreferrer"><img src="https://img.shields.io/badge/contributions-welcome-brightgreen.svg?style=flat" alt="contributionswelcome"></a> üôå</p>

<h2 id="references">References</h2>

<ul>
  <li><a href="https://github.com/NikiforovAll/keycloak-authorization-services-dotnet" target="_blank" rel="noopener noreferrer">https://github.com/NikiforovAll/keycloak-authorization-services-dotnet</a></li>
  <li><a href="https://nikiforovall.github.io/keycloak-authorization-services-dotnet/devex/aspire.html" target="_blank" rel="noopener noreferrer">https://nikiforovall.github.io/keycloak-authorization-services-dotnet/devex/aspire.html</a></li>
  <li><a href="https://learn.microsoft.com/en-us/dotnet/aspire/" target="_blank" rel="noopener noreferrer">https://learn.microsoft.com/en-us/dotnet/aspire/</a></li>
</ul>

	</div>

	

	
	<ul class="list-inline">
		<li>
<i class="fa-solid fa-bookmark"></i> Topics:</li>
		
		
		
		<li>
			<a href="/topics.html#dotnet-cat-ref">
				dotnet <span>(60)</span>
			</a>
			 ¬∑
		</li>
		
		<li>
			<a href="/topics.html#keycloak-cat-ref">
				keycloak <span>(4)</span>
			</a>
			 ¬∑
		</li>
		
		
		
		
		
		<li>
			<a href="/topics.html#dotnet-tag-ref">
				dotnet <span>(65)</span>
			</a>
			 ¬∑
		</li>
		
		<li>
			<a href="/topics.html#aspnetcore-tag-ref">
				aspnetcore <span>(24)</span>
			</a>
			 ¬∑
		</li>
		
		<li>
			<a href="/topics.html#keycloak-tag-ref">
				keycloak <span>(6)</span>
			</a>
			 ¬∑
		</li>
		
		<li>
			<a href="/topics.html#aspire-tag-ref">
				aspire <span>(22)</span>
			</a>
			
		</li>
		
		
		
	</ul>
	

	<hr>

	<div>
		<section class="share col-sm-6">
			<h4 class="section-title">Share Post</h4>
			<a class="btn btn-default btn-sm twitter" href="http://x.com/share?&amp;via=nikiforovall" onclick="window.open(this.href, 'x-share', 'width=550,height=235');return false;" target="_blank" rel="noopener noreferrer">
				<i class="fa-brands fa-x-twitter fa-lg"></i>
				X
			</a>
		</section>

		<section class="col-sm-6 author">
			<img src="//www.gravatar.com/avatar/e86fa0938976c38907a302ecb208f011" class="img-rounded author-image">
			<h4 class="section-title author-name">Oleksii Nikiforov</h4>
			<p class="author-bio">Jibber-jabbering about programming and IT.</p>
		</section>
	</div>

	<div class="clearfix"></div>

	<ul class="pager">
		
		<li class="previous"><a href="/dotnet/aws/2024/05/27/aws-claim-check-dotnet.html" title="Claim-Check Pattern with AWS Message Processing Framework for .NET and Aspire">‚Üê
				Previous</a></li>
		
		
		<li class="next">
<a href="/dotnet/opentelemetry/2024/06/07/test-instrumentation-with-otel-aspire.html" title="Automated Tests instrumentation via OpenTelemetry and Aspire Dashboard">Next ‚Üí</a>
		</li>
		
	</ul>

	<hr>
	</div>

	<div class="col-sm-2 sidebar-2">

	</div>

</article>
<div class="clearfix"></div>



    
    <script src="https://utteranc.es/client.js" repo="NikiforovAll/nikiforovall.github.io" issue-term="pathname" label="Blog" theme="preferred-color-scheme" crossorigin="anonymous" async>
    </script>





		<footer>
			<hr>
			<p>
				¬© 2026 Oleksii Nikiforov with <a href="http://jekyllrb.com/" target="_blank" rel="noopener noreferrer">Jekyll</a>. Theme: <a href="https://github.com/dbtek/dbyll" target="_blank" rel="noopener noreferrer">dbyll</a> by dbtek.
			</p>
		</footer>
	</div>

	<script type="text/javascript" src="/assets/resources/jquery/jquery.min.js"></script>
	<script type="text/javascript" src="/assets/resources/bootstrap/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="/assets/js/app.js"></script>
	<script src="https://unpkg.com/lunr/lunr.js"></script>
	<script type="text/javascript" src="/assets/js/search.js"></script>
	<script type="text/javascript" src="/assets/js/copy-code.js"></script>
	
		<script type="text/javascript" src="https://unpkg.com/mermaid@10.9.0/dist/mermaid.min.js">
</script>
<script>
$(document).ready(function() {
    mermaid.initialize({
        theme: 'forest'
    });
});
</script>

	
</body>
</html>



<!-- Asynchronous Google Analytics snippet -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-164555539-1', 'auto');
  ga('send', 'pageview');
</script>

