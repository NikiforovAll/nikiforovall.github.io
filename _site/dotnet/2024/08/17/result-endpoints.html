<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<!-- <meta http-equiv="Content-Security-Policy" content="frame-src https://try.dot.net;"> -->
	<title>Unlocking the Power of TypedResults in Endpoints: A Consistent Approach to Strongly Typed APIs in .NET</title>
	
	<meta name="author" content="Oleksii Nikiforov">

	<!-- Enable responsive viewport -->
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
	<!--[if lt IE 9]>
	<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->

	<!-- Le styles -->
	<link href="https://nikiforovall.github.io/assets/resources/bootstrap/css/bootstrap.min.css" rel="stylesheet">
	<link href="https://nikiforovall.github.io/assets/resources/font-awesome/css/font-awesome.min.css" rel="stylesheet">
	<link href="https://nikiforovall.github.io/assets/resources/syntax/syntax.css" rel="stylesheet">
	<link href="https://nikiforovall.github.io/assets/css/style.css" rel="stylesheet">

	<!-- Le fav and touch icons -->
	<!-- Update these with your own images
	<link rel="shortcut icon" href="images/favicon.ico">
	<link rel="apple-touch-icon" href="images/apple-touch-icon.png">
	<link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
	-->
	<link rel="shortcut icon" href="/assets/media/favicon.ico">

	<link rel="alternate" type="application/rss+xml" title="" href="https://nikiforovall.github.io/feed.xml">
</head>

<body>
	<nav class="navbar navbar-default visible-xs" role="navigation">
		<!-- Brand and toggle get grouped for better mobile display -->
		<div class="navbar-header">
			<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			
			<a type="button" class="navbar-toggle nav-link" href="http://github.com/nikiforovAll" target="_blank" rel="noopener noreferrer">
				<i class="fa fa-github"></i>
			</a>
			
			
			<a type="button" class="navbar-toggle nav-link" href="http://twitter.com/nikiforovall" target="_blank" rel="noopener noreferrer">
				<i class="fa fa-twitter"></i>
			</a>
			
			
			<a type="button" class="navbar-toggle nav-link" href="mailto:alexey.nikiforovall@gmail.com">
				<i class="fa fa-envelope"></i>
			</a>
			
			<a class="navbar-brand" href="https://nikiforovall.github.io/" target="_blank" rel="noopener noreferrer">
				<img src="//www.gravatar.com/avatar/e86fa0938976c38907a302ecb208f011?s=35" class="img-circle">
				N+1 Blog
			</a>
		</div>

		<!-- Collect the nav links, forms, and other content for toggling -->
		<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
			<ul class="nav navbar-nav">
				<li class="active"><a href="https://nikiforovall.github.io/" target="_blank" rel="noopener noreferrer">Home</a></li>
				<li><a href="https://nikiforovall.github.io/categories.html" target="_blank" rel="noopener noreferrer">Categories</a></li>
				<li><a href="https://nikiforovall.github.io/tags.html" target="_blank" rel="noopener noreferrer">Tags</a></li>
				<li><a href="https://nikiforovall.github.io/about.html" target="_blank" rel="noopener noreferrer">About</a></li>
			</ul>
		</div>
<!-- /.navbar-collapse -->
	</nav>

	<!-- nav-menu-dropdown -->
	<div class="btn-group hidden-xs" id="nav-menu">
		<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
			<i class="fa fa-bars"></i>
		</button>
		<ul class="dropdown-menu" role="menu">
			<li><a href="https://nikiforovall.github.io/" target="_blank" rel="noopener noreferrer"><i class="fa fa-home"></i>Home</a></li>
			<li><a href="https://nikiforovall.github.io/categories.html" target="_blank" rel="noopener noreferrer"><i class="fa fa-folder"></i>Categories</a></li>
			<li><a href="https://nikiforovall.github.io/tags.html" target="_blank" rel="noopener noreferrer"><i class="fa fa-tags"></i>Tags</a></li>
			<li><a href="https://nikiforovall.github.io/about.html" target="_blank" rel="noopener noreferrer"><i class="fa fa-pencil"></i>About</a></li>
			<li class="divider">
			<li><a href="#"><i class="fa fa-arrow-up"></i>Top of Page</a></li>
		</ul>
	</div>

	<div class="col-sm-3 sidebar hidden-xs" style="">
		<!-- sidebar.html -->
<header class="sidebar-header" role="banner">
	<a href="https://nikiforovall.github.io/" target="_blank" rel="noopener noreferrer">
		<img src="//www.gravatar.com/avatar/e86fa0938976c38907a302ecb208f011?s=150" class="img-circle">
	</a>
	<h3 class="title">
        <a href="https://nikiforovall.github.io/" target="_blank" rel="noopener noreferrer">N+1 Blog</a>
    </h3>
</header>


<div id="bio" class="text-center">
	Jibber-jabbering about programming and IT.
</div>


<div id="contact-list" class="text-center">
	<ul class="list-unstyled list-inline">
		
		<li>
			<a class="btn btn-default btn-sm" href="https://github.com/nikiforovAll" target="_blank" rel="noopener noreferrer">
				<i class="fa fa-github-alt fa-lg"></i>
			</a>
		</li>
		
		
		<li>
			<a class="btn btn-default btn-sm" href="https://twitter.com/nikiforovall" target="_blank" rel="noopener noreferrer">
				<i class="fa fa-twitter fa-lg"></i>
			</a>
		</li>
		
		
		<li>
			<a class="btn btn-default btn-sm" href="https://t.me/nikiforovallblog" target="_blank" rel="noopener noreferrer">
				<i class="fa fa-pencil-square fa-lg"></i>
			</a>
		</li>
		
		
		<li>
			<a class="btn btn-default btn-sm" href="mailto:alexey.nikiforovall@gmail.com">
				<i class="fa fa-envelope fa-lg"></i>
			</a>
		</li>
		
	</ul>
	<ul id="contact-list-secondary" class="list-unstyled list-inline">
		
		
		<li>
			<a class="btn btn-default btn-sm" href="https://linkedin.com/in/nikiforov-oleksii" target="_blank" rel="noopener noreferrer">
				<i class="fa fa-linkedin fa-lg"></i>
			</a>
		</li>
		
		<li>
			<a class="btn btn-default btn-sm" href="https://nikiforovall.github.io/feed.xml" target="_blank" rel="noopener noreferrer">
				<i class="fa fa-rss fa-lg"></i>
			</a>
		</li>
	</ul>
</div>
<!-- sidebar.html end -->

	</div>

	<div class="col-sm-9 col-sm-offset-3">
		<div class="page-header">
	<h1>Unlocking the Power of TypedResults in Endpoints: A Consistent Approach to Strongly Typed APIs in .NET </h1>
</div>
<article>

	<div class="col-sm-10">

		<span class="post-date">
			
			August
			17th,
			
			2024
		</span>

	
	
	
	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	
	

	<div class="article_body" style="margin-top: 30px;">
		<h2 id="tldr">TL;DR</h2>

<ul>
  <li><a href="#tldr">TL;DR</a></li>
  <li>
<a href="#introduction">Introduction</a>
    <ul>
      <li><a href="#motivation">Motivation</a></li>
    </ul>
  </li>
  <li>
<a href="#solution---use-typedresults">Solution - use <code class="language-plaintext highlighter-rouge">TypedResults</code></a>
    <ul>
      <li>
<a href="#example">Example</a>
        <ul>
          <li><a href="#adding-openapi-metadata">Adding OpenAPI metadata</a></li>
          <li><a href="#automatic-model-validation">Automatic model validation</a></li>
          <li><a href="#exception-handling">Exception handling</a></li>
        </ul>
      </li>
      <li><a href="#control-the-serialization-via-jsonserializeroptions">Control the serialization via <code class="language-plaintext highlighter-rouge">JsonSerializerOptions</code></a></li>
    </ul>
  </li>
  <li><a href="#bonus-nallresultendpointstemplate-template">Bonus: <code class="language-plaintext highlighter-rouge">Nall.ResultEndpoints.Template</code> template</a></li>
  <li><a href="#conclusion">Conclusion</a></li>
  <li><a href="#references">References</a></li>
</ul>

<p>This blog post explores the use of <code class="language-plaintext highlighter-rouge">TypedResults</code> in .NET endpoints to achieve a consistent and strongly typed API development approach. We discuss the benefits of <code class="language-plaintext highlighter-rouge">TypedResults</code> over traditional <code class="language-plaintext highlighter-rouge">ActionResult</code>, emphasizing how they enhance type safety and API consistency.</p>

<p><strong>Source code</strong>: <a href="https://github.com/NikiforovAll/result-endpoints-template" target="_blank" rel="noopener noreferrer">https://github.com/NikiforovAll/result-endpoints-template</a></p>

<p>You can use <code class="language-plaintext highlighter-rouge">dotnet new</code> template to get started with <code class="language-plaintext highlighter-rouge">TypedResults</code> in your .NET projects:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dotnet new <span class="nb">install </span>Nall.ResultEndpoints.Template
dotnet new result-endpoints-api
</code></pre></div></div>

<p>Here is a simple example of how you can use <code class="language-plaintext highlighter-rouge">TypedResults</code> in your .NET endpoints:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">HelloWorld</span> <span class="p">:</span> <span class="n">EndpointBaseSync</span><span class="p">.</span><span class="n">WithRequest</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;.</span><span class="n">WithResult</span><span class="p">&lt;</span><span class="n">Ok</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;&gt;</span>
<span class="p">{</span>
    <span class="p">[</span><span class="nf">EndpointSummary</span><span class="p">(</span><span class="s">"Says hello"</span><span class="p">)]</span>
    <span class="p">[</span><span class="nf">EndpointName</span><span class="p">(</span><span class="k">nameof</span><span class="p">(</span><span class="n">HelloWorld</span><span class="p">))]</span>
    <span class="p">[</span><span class="nf">HttpGet</span><span class="p">(</span><span class="s">"/hello-world"</span><span class="p">)]</span>
    <span class="k">public</span> <span class="k">override</span> <span class="n">Results</span><span class="p">&lt;</span><span class="n">Ok</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;&gt;</span> <span class="nf">Handle</span><span class="p">([</span><span class="nf">FromQuery</span><span class="p">(</span><span class="n">Name</span> <span class="p">=</span> <span class="s">"q"</span><span class="p">)]</span> <span class="kt">string</span> <span class="n">request</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">TypedResults</span><span class="p">.</span><span class="nf">Ok</span><span class="p">(</span><span class="s">$"Hello, </span><span class="p">{</span><span class="n">request</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="introduction">Introduction</h2>

<p>In this blog post I want to show you the opinionated approach to building APIs in .NET using <code class="language-plaintext highlighter-rouge">TypedResults</code> in MVC based Web API implementations (aka Controllers).</p>

<p>💡 Thought this article, I will use an awesome library called <a href="https://github.com/ardalis/ApiEndpoints" target="_blank" rel="noopener noreferrer">Ardalis.ApiEndpoints</a> it’s basically an alternative to the traditional <code class="language-plaintext highlighter-rouge">Controller</code> approach in ASP.NET Core built on top of MVC. It provides a more structured and consistent way to build APIs using <code class="language-plaintext highlighter-rouge">Endpoints</code> instead of <code class="language-plaintext highlighter-rouge">Controllers</code>. The approach resembles the minimal API approach but differs in many ways.</p>

<p>From the <code class="language-plaintext highlighter-rouge">Ardalis.ApiEndpoints</code> documentation:</p>

<blockquote>
  <p>MVC Controllers are essentially an antipattern. They’re dinosaurs. They are collections of methods that never call one another and rarely operate on the same state. They’re not cohesive. They tend to become bloated and to grow out of control…</p>
</blockquote>

<p>My goal is to show you how to enhance the <code class="language-plaintext highlighter-rouge">Ardalis.ApiEndpoints</code> library with <code class="language-plaintext highlighter-rouge">TypedResults</code> to achieve a more consistent and strongly typed API development approach.</p>

<h3 id="motivation">Motivation</h3>

<p>But, first, let’s talk about the problem we are trying to solve. When you are building an API, you need to return a response to the client. In .NET, you can use <code class="language-plaintext highlighter-rouge">ActionResult</code> to return a response from your endpoint. However, <code class="language-plaintext highlighter-rouge">ActionResult</code> is an umbrella type that can represent any kind of response.</p>

<p>But, these details are important since they are part of the public contract of your API, we should manage them explicitly and carefully.</p>

<p>☝️Furthermore, since the OpenAPI specification is becoming more and more popular, it is important to have a consistent response structure across your API. Nowadays, it is common to generate OpenAPI documentation and client SDKs based on your API code. If you use <code class="language-plaintext highlighter-rouge">ActionResult</code>, you will have to manually document the response structure in your OpenAPI definitions, which can lead to <em>inconsistencies between the actual response and OpenAPI definitions</em>.</p>

<p>Take a look at example below:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">HelloWorldActionResult</span> <span class="p">:</span> <span class="n">EndpointBaseSync</span><span class="p">.</span><span class="n">WithRequest</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;.</span><span class="n">WithActionResult</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span>
<span class="p">{</span>
    <span class="p">[</span><span class="nf">HttpGet</span><span class="p">(</span><span class="s">"/hello-world"</span><span class="p">)]</span>
    <span class="p">[</span><span class="nf">ProducesResponseType</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="kt">string</span><span class="p">),</span> <span class="n">StatusCodes</span><span class="p">.</span><span class="n">Status200OK</span><span class="p">)]</span>
    <span class="p">[</span><span class="nf">ProducesResponseType</span><span class="p">(</span><span class="n">StatusCodes</span><span class="p">.</span><span class="n">Status400BadRequest</span><span class="p">)]</span>
    <span class="k">public</span> <span class="k">override</span> <span class="n">ActionResult</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="nf">Handle</span><span class="p">(</span><span class="kt">string</span> <span class="n">request</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">request</span> <span class="p">==</span> <span class="s">"badrequest"</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="nf">BadRequest</span><span class="p">(</span><span class="k">new</span> <span class="p">{</span> <span class="n">message</span> <span class="p">=</span> <span class="s">"Something bad happened"</span> <span class="p">});</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nf">Ok</span><span class="p">(</span><span class="s">$"Hello, </span><span class="p">{</span><span class="n">request</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>What is wrong with this code? The problem is that the response structure is not explicitly defined in the code. The response structure is defined in the <code class="language-plaintext highlighter-rouge">ProducesResponseType</code> attribute, which is not enforced by the compiler. This can lead to inconsistencies between the actual response and OpenAPI definitions.</p>

<h2 id="solution---use-typedresults">Solution - use <code class="language-plaintext highlighter-rouge">TypedResults</code>
</h2>

<p>Turns out you can use <code class="language-plaintext highlighter-rouge">TypedResults</code> to solve this problem. 🤔</p>

<p>The <code class="language-plaintext highlighter-rouge">IResult</code> interface defines a contract that represents the result of an HTTP endpoint. The static <code class="language-plaintext highlighter-rouge">Results</code> class and the static <code class="language-plaintext highlighter-rouge">TypedResults</code> are used to create various <code class="language-plaintext highlighter-rouge">IResult</code> objects that represent different types of responses. It is usually used in in <a href="https://learn.microsoft.com/en-us/aspnet/core/fundamentals/minimal-apis/responses?view=aspnetcore-8.0#iresult-return-values" target="_blank" rel="noopener noreferrer">minimal APIs scenarios</a>.</p>

<p>Returning <code class="language-plaintext highlighter-rouge">TypedResults</code> rather than <code class="language-plaintext highlighter-rouge">Results</code> has the following advantages:</p>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">TypedResults</code> helpers return strongly typed objects, which can improve code readability, unit testing, and reduce the chance of runtime errors.</li>
  <li>The implementation type <a href="https://learn.microsoft.com/en-us/aspnet/core/fundamentals/openapi/aspnetcore-openapi#describe-response-types" target="_blank" rel="noopener noreferrer">automatically provides the response type metadata for OpenAPI</a> to describe the endpoint. 🤩</li>
</ul>

<p>Although, <code class="language-plaintext highlighter-rouge">TypedResults</code> class is usually used in minimal APIs scenarios,it can be used in MVC based Web API implementations as well.</p>

<h3 id="example">Example</h3>

<p>Down below, we define an endpoints that returns <code class="language-plaintext highlighter-rouge">Results&lt;Ok&lt;string&gt;, BadRequest&lt;ProblemDetails&gt;&gt;</code> which is like a discriminated union of <code class="language-plaintext highlighter-rouge">Ok&lt;string&gt;</code> and <code class="language-plaintext highlighter-rouge">BadRequest&lt;ProblemDetails&gt;</code>. It means that the endpoint can return either <code class="language-plaintext highlighter-rouge">Ok&lt;string&gt;</code> or <code class="language-plaintext highlighter-rouge">BadRequest&lt;ProblemDetails&gt;</code>. Trying to return any other type will result in a compile-time error. This is exactly what we want to achieve!</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">HelloWorld</span> <span class="p">:</span> <span class="n">EndpointBaseSync</span><span class="p">.</span><span class="n">WithRequest</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;.</span><span class="n">WithResult</span><span class="p">&lt;</span><span class="n">Results</span><span class="p">&lt;</span><span class="n">Ok</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;,</span> <span class="n">BadRequest</span><span class="p">&lt;</span><span class="n">ProblemDetails</span><span class="p">&gt;&gt;</span>
    <span class="p">&gt;</span>
<span class="p">{</span>
    <span class="p">[</span><span class="nf">HttpGet</span><span class="p">(</span><span class="s">"/hello-world"</span><span class="p">)]</span>
    <span class="k">public</span> <span class="k">override</span> <span class="n">Results</span><span class="p">&lt;</span><span class="n">Ok</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;,</span> <span class="n">BadRequest</span><span class="p">&lt;</span><span class="n">ProblemDetails</span><span class="p">&gt;&gt;</span> <span class="nf">Handle</span><span class="p">(</span><span class="kt">string</span> <span class="n">request</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">request</span> <span class="p">==</span> <span class="s">"badrequest"</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="n">TypedResults</span><span class="p">.</span><span class="nf">BadRequest</span><span class="p">(</span>
                <span class="n">TypedResults</span><span class="p">.</span><span class="nf">Problem</span><span class="p">(</span><span class="s">"Something bad happened"</span><span class="p">).</span><span class="n">ProblemDetails</span>
            <span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">TypedResults</span><span class="p">.</span><span class="nf">Ok</span><span class="p">(</span><span class="s">$"Hello, </span><span class="p">{</span><span class="n">request</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>My goal is to give you a <strong>comprehensive guide</strong> to this approach. Let’s take a look at some other scenarios and gotchas you might encounter when using <code class="language-plaintext highlighter-rouge">TypedResults</code> and <code class="language-plaintext highlighter-rouge">Ardalis.ApiEndpoints</code> in your .NET projects.</p>

<h4 id="adding-openapi-metadata">Adding OpenAPI metadata</h4>

<p>To add OpenAPI metadata to your endpoint, you can use the <code class="language-plaintext highlighter-rouge">EndpointSummary</code> and <code class="language-plaintext highlighter-rouge">EndpointName</code> attributes. They are defined in <code class="language-plaintext highlighter-rouge">Microsoft.AspNetCore.Http</code> namespace and are used by <code class="language-plaintext highlighter-rouge">Swashbuckle.AspNetCore</code> to generate OpenAPI documentation. The great thing about these attributes is that they are OpenAPI-generation library agnostic which gives you the flexibility to switch between different libraries.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">HelloWorld</span> <span class="p">:</span> <span class="n">EndpointBaseSync</span><span class="p">.</span><span class="n">WithRequest</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;.</span><span class="n">WithResult</span><span class="p">&lt;</span><span class="n">Ok</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;&gt;</span>
<span class="p">{</span>
    <span class="p">[</span><span class="nf">EndpointSummary</span><span class="p">(</span><span class="s">"Says hello"</span><span class="p">)]</span>
    <span class="p">[</span><span class="nf">EndpointDescription</span><span class="p">(</span><span class="s">"Says hello based on the request"</span><span class="p">)]</span>
    <span class="p">[</span><span class="nf">Tags</span><span class="p">(</span><span class="s">"Hello"</span><span class="p">)]</span>
    <span class="p">[</span><span class="nf">EndpointName</span><span class="p">(</span><span class="k">nameof</span><span class="p">(</span><span class="n">HelloWorld</span><span class="p">))]</span>
    <span class="p">[</span><span class="nf">HttpGet</span><span class="p">(</span><span class="s">"/hello-world"</span><span class="p">)]</span>
    <span class="k">public</span> <span class="k">override</span> <span class="n">Ok</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="nf">Handle</span><span class="p">([</span><span class="nf">FromQuery</span><span class="p">(</span><span class="n">Name</span> <span class="p">=</span> <span class="s">"q"</span><span class="p">)]</span> <span class="p">[</span><span class="nf">Length</span><span class="p">(</span><span class="m">3</span><span class="p">,</span> <span class="m">100</span><span class="p">)]</span> <span class="kt">string</span> <span class="n">request</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">TypedResults</span><span class="p">.</span><span class="nf">Ok</span><span class="p">(</span><span class="s">$"Hello, </span><span class="p">{</span><span class="n">request</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="automatic-model-validation">Automatic model validation</h4>

<p>By default, <code class="language-plaintext highlighter-rouge">EndpointBaseSync</code> and <code class="language-plaintext highlighter-rouge">EndpointBaseAsync</code> inherits from <code class="language-plaintext highlighter-rouge">ControllerBase</code> which means that the model validation is automatically enabled. This means that if you have a model with data annotations, the model will be automatically validated before the endpoint is executed. If the model is invalid, the endpoint will return <code class="language-plaintext highlighter-rouge">BadRequest&lt;ProblemDetails&gt;</code> with the validation errors. You can control this behavior by setting the <code class="language-plaintext highlighter-rouge">SuppressModelStateInvalidFilter</code> property in the <code class="language-plaintext highlighter-rouge">ApiBehaviorOptions</code> option.</p>

<p>But because of this automatic validation, a <em>problem arises</em>. The <code class="language-plaintext highlighter-rouge">BadRequest&lt;ProblemDetails&gt;</code> response produced via model validation is not a regular response type because it is not returned by the endpoint itself; instead, it is returned by the framework when the model is invalid.</p>

<p>To fix this, we can assume that all endpoints can potentially return <code class="language-plaintext highlighter-rouge">BadRequest&lt;ProblemDetails&gt;</code> and add it to the list of possible responses globally. This way, we can ensure that the response structure is consistent across all endpoints.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kt">var</span> <span class="n">builder</span> <span class="p">=</span> <span class="n">WebApplication</span><span class="p">.</span><span class="nf">CreateBuilder</span><span class="p">(</span><span class="n">args</span><span class="p">);</span>

<span class="n">builder</span><span class="p">.</span><span class="n">Services</span><span class="p">.</span><span class="nf">AddProblemDetails</span><span class="p">();</span>

<span class="n">builder</span><span class="p">.</span><span class="n">Services</span><span class="p">.</span><span class="nf">AddControllers</span><span class="p">(</span><span class="n">options</span> <span class="p">=&gt;</span>
<span class="p">{</span>
    <span class="n">options</span><span class="p">.</span><span class="n">Filters</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="nf">ProducesResponseTypeAttribute</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">ProblemDetails</span><span class="p">),</span> <span class="m">400</span><span class="p">));</span> <span class="c1">// add this to solve the problem</span>
<span class="p">});</span>

<span class="n">builder</span><span class="p">.</span><span class="n">Services</span><span class="p">.</span><span class="n">Configure</span><span class="p">&lt;</span><span class="n">ApiBehaviorOptions</span><span class="p">&gt;(</span><span class="n">options</span> <span class="p">=&gt;</span>
<span class="p">{</span>
    <span class="n">options</span><span class="p">.</span><span class="n">SuppressModelStateInvalidFilter</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span> <span class="c1">// just an example, validation is enabled by default</span>
<span class="p">});</span>

<span class="kt">var</span> <span class="n">app</span> <span class="p">=</span> <span class="n">builder</span><span class="p">.</span><span class="nf">Build</span><span class="p">();</span>
<span class="n">app</span><span class="p">.</span><span class="nf">MapControllers</span><span class="p">();</span>

<span class="n">app</span><span class="p">.</span><span class="nf">Run</span><span class="p">();</span>
</code></pre></div></div>

<p>Let’s apply some request validation to our endpoint:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">HelloWorld</span> <span class="p">:</span> <span class="n">EndpointBaseSync</span><span class="p">.</span><span class="n">WithRequest</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;.</span><span class="n">WithResult</span><span class="p">&lt;</span><span class="n">Ok</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;&gt;</span>
<span class="p">{</span>
    <span class="p">[</span><span class="nf">EndpointSummary</span><span class="p">(</span><span class="s">"Says hello"</span><span class="p">)]</span>
    <span class="p">[</span><span class="nf">EndpointDescription</span><span class="p">(</span><span class="s">"Says hello based on the request"</span><span class="p">)]</span>
    <span class="p">[</span><span class="nf">Tags</span><span class="p">(</span><span class="s">"Hello"</span><span class="p">)]</span>
    <span class="p">[</span><span class="nf">EndpointName</span><span class="p">(</span><span class="k">nameof</span><span class="p">(</span><span class="n">HelloWorld</span><span class="p">))]</span>
    <span class="p">[</span><span class="nf">HttpGet</span><span class="p">(</span><span class="s">"/hello-world"</span><span class="p">)]</span>
    <span class="k">public</span> <span class="k">override</span> <span class="n">Ok</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="nf">Handle</span><span class="p">([</span><span class="nf">FromQuery</span><span class="p">(</span><span class="n">Name</span> <span class="p">=</span> <span class="s">"q"</span><span class="p">)]</span> <span class="p">[</span><span class="nf">Length</span><span class="p">(</span><span class="m">3</span><span class="p">,</span> <span class="m">100</span><span class="p">)]</span> <span class="kt">string</span> <span class="n">request</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">TypedResults</span><span class="p">.</span><span class="nf">Ok</span><span class="p">(</span><span class="s">$"Hello, </span><span class="p">{</span><span class="n">request</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<center>
    <img src="/assets/result-endpoints/validation-demo.png" style="margin: 15px;" width="100%">
</center>

<p>And here is the response:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ curl <span class="nt">-X</span> <span class="s1">'GET'</span>   <span class="s1">'http://localhost:5164/hello-world?q=1'</span>   <span class="nt">-H</span> <span class="s1">'accept: application/json'</span> <span class="nt">-s</span> | jq
</code></pre></div></div>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://tools.ietf.org/html/rfc9110#section-15.5.1"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"One or more validation errors occurred."</span><span class="p">,</span><span class="w">
  </span><span class="nl">"status"</span><span class="p">:</span><span class="w"> </span><span class="mi">400</span><span class="p">,</span><span class="w">
  </span><span class="nl">"errors"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"q"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="s2">"The field request must be a string or collection type with a minimum length of '3' and maximum length of '100'."</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"traceId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"00-6f6f77eb35c176f153d8d9b5378b69d9-9fa65ede2b6d7ba0-00"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h4 id="exception-handling">Exception handling</h4>

<p>I don’t recommend to use exceptions for the control flow in your application. However, they are inevitable. It means this is another case when we want to extend common response types to make our API consistent. The approach is similar to the one we used for model validation.</p>

<p>It is a global exception handler added via <code class="language-plaintext highlighter-rouge">UseExceptionHandler</code> that returns <code class="language-plaintext highlighter-rouge">InternalServerError&lt;ProblemDetails&gt;</code>.</p>

<p>See the official docs for more details: <a href="https://learn.microsoft.com/en-us/aspnet/core/fundamentals/error-handling?view=aspnetcore-8.0" target="_blank" rel="noopener noreferrer">Handle errors in ASP.NET Core</a>.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kt">var</span> <span class="n">builder</span> <span class="p">=</span> <span class="n">WebApplication</span><span class="p">.</span><span class="nf">CreateBuilder</span><span class="p">(</span><span class="n">args</span><span class="p">);</span>

<span class="n">builder</span><span class="p">.</span><span class="n">Services</span><span class="p">.</span><span class="nf">AddProblemDetails</span><span class="p">();</span>

<span class="n">builder</span><span class="p">.</span><span class="n">Services</span><span class="p">.</span><span class="nf">AddControllers</span><span class="p">(</span><span class="n">options</span> <span class="p">=&gt;</span>
<span class="p">{</span>
    <span class="n">options</span><span class="p">.</span><span class="n">Filters</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="nf">ProducesResponseTypeAttribute</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">ProblemDetails</span><span class="p">),</span> <span class="m">500</span><span class="p">));</span> <span class="c1">// add this to solve the problem</span>
    <span class="n">options</span><span class="p">.</span><span class="n">Filters</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="nf">ProducesResponseTypeAttribute</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">ProblemDetails</span><span class="p">),</span> <span class="m">400</span><span class="p">));</span>
<span class="p">})</span>

<span class="kt">var</span> <span class="n">app</span> <span class="p">=</span> <span class="n">builder</span><span class="p">.</span><span class="nf">Build</span><span class="p">();</span>

<span class="n">app</span><span class="p">.</span><span class="nf">MapControllers</span><span class="p">();</span>
<span class="n">app</span><span class="p">.</span><span class="nf">UseExceptionHandler</span><span class="p">();</span>
<span class="n">app</span><span class="p">.</span><span class="nf">UseStatusCodePages</span><span class="p">();</span>

<span class="n">app</span><span class="p">.</span><span class="nf">Run</span><span class="p">();</span>
</code></pre></div></div>

<p>Here is an example of response:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ curl <span class="nt">-X</span> <span class="s1">'GET'</span>   <span class="s1">'http://localhost:5164/hello-world?q=error'</span>   <span class="nt">-H</span> <span class="s1">'accept: application/json'</span> <span class="nt">-s</span> | jq
</code></pre></div></div>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://tools.ietf.org/html/rfc9110#section-15.6.1"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"System.Exception"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"status"</span><span class="p">:</span><span class="w"> </span><span class="mi">500</span><span class="p">,</span><span class="w">
  </span><span class="nl">"detail"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Something went wrong..."</span><span class="p">,</span><span class="w">
  </span><span class="nl">"exception"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"details"</span><span class="p">:</span><span class="w"> </span><span class="s2">"System.Exception: Something went wrong...</span><span class="se">\r\n</span><span class="s2">   at ResultEndpoints.Endpoints.HelloWorld.Handle(String request) ..."</span><span class="p">,</span><span class="w">
    </span><span class="nl">"path"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/hello-world"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"endpoint"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ResultEndpoints.Endpoints.HelloWorld.Handle (ResultEndpoints)"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"routeValues"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Handle"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"controller"</span><span class="p">:</span><span class="w"> </span><span class="s2">"HelloWorld"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"traceId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"00-1b84386819492efe10684550ca737f1e-d06bfba710a5655c-00"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h3 id="control-the-serialization-via-jsonserializeroptions">Control the serialization via <code class="language-plaintext highlighter-rouge">JsonSerializerOptions</code>
</h3>

<p>There is a gotacha when using <code class="language-plaintext highlighter-rouge">TypedResults</code> - when returning a TypedResult from a controller or minimal API endpoint the configured JsonOptions are not used.</p>

<p>Take a look at <a href="https://github.com/dotnet/aspnetcore/issues/45872" target="_blank" rel="noopener noreferrer">https://github.com/dotnet/aspnetcore/issues/45872</a> for more details.</p>

<p>For example, if you want to specify <code class="language-plaintext highlighter-rouge">JsonStringEnumConverter</code> to control the serialization of enums, you need to add it to multiple places to make it work correctly.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">var</span> <span class="n">builder</span> <span class="p">=</span> <span class="n">WebApplication</span><span class="p">.</span><span class="nf">CreateBuilder</span><span class="p">(</span><span class="n">args</span><span class="p">);</span>

<span class="kt">var</span> <span class="n">enumConverter</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">JsonStringEnumConverter</span><span class="p">(</span><span class="n">JsonNamingPolicy</span><span class="p">.</span><span class="n">SnakeCaseLower</span><span class="p">);</span>

<span class="n">builder</span><span class="p">.</span><span class="n">Services</span><span class="p">.</span><span class="nf">AddControllers</span><span class="p">().</span><span class="nf">AddJsonOptions</span><span class="p">(</span><span class="n">options</span> <span class="p">=&gt;</span>
<span class="p">{</span>
    <span class="n">options</span><span class="p">.</span><span class="n">JsonSerializerOptions</span><span class="p">.</span><span class="n">Converters</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">enumConverter</span><span class="p">);</span>
<span class="p">});</span>

<span class="n">builder</span><span class="p">.</span><span class="n">Services</span><span class="p">.</span><span class="nf">ConfigureHttpJsonOptions</span><span class="p">(</span><span class="n">opt</span> <span class="p">=&gt;</span>
<span class="p">{</span>
    <span class="c1">// this one is used during the serialization of the response TypedResults, ref: https://github.com/dotnet/aspnetcore/issues/45872</span>
    <span class="n">opt</span><span class="p">.</span><span class="n">SerializerOptions</span><span class="p">.</span><span class="n">Converters</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">enumConverter</span><span class="p">);</span>
<span class="p">});</span>

<span class="kt">var</span> <span class="n">app</span> <span class="p">=</span> <span class="n">builder</span><span class="p">.</span><span class="nf">Build</span><span class="p">();</span>
<span class="n">app</span><span class="p">.</span><span class="nf">MapControllers</span><span class="p">();</span>
<span class="n">app</span><span class="p">.</span><span class="nf">Run</span><span class="p">();</span>
</code></pre></div></div>

<h2 id="bonus-nallresultendpointstemplate-template">Bonus: <code class="language-plaintext highlighter-rouge">Nall.ResultEndpoints.Template</code> template</h2>

<p>I’ve prepare  a <code class="language-plaintext highlighter-rouge">dotnet new</code> template to get started with <code class="language-plaintext highlighter-rouge">TypedResults</code> in your .NET projects. You can install it via the following command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dotnet new <span class="nb">install </span>Nall.ResultEndpoints.
</code></pre></div></div>

<p>It has everything you need to get started with this approach. You can create a new project using the following command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dotnet new result-endpoints-api
</code></pre></div></div>

<center>
    <img src="/assets/result-endpoints/swagger.png" style="margin: 15px;" width="100%">
</center>

<p>Here are some of the endpoints that you can find in the template:</p>

<p>List all todos:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">record</span> <span class="nc">ListTodosRequest</span>
<span class="p">{</span>
    <span class="p">[</span><span class="nf">FromQuery</span><span class="p">(</span><span class="n">Name</span> <span class="p">=</span> <span class="s">"completed"</span><span class="p">)]</span>
    <span class="k">public</span> <span class="kt">bool</span><span class="p">?</span> <span class="n">Completed</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">ListTodos</span><span class="p">(</span><span class="n">TodoContext</span> <span class="n">context</span><span class="p">)</span>
    <span class="p">:</span> <span class="n">EndpointBaseSync</span><span class="p">.</span><span class="n">WithRequest</span><span class="p">&lt;</span><span class="n">ListTodosRequest</span><span class="p">&gt;.</span><span class="n">WithResult</span><span class="p">&lt;</span><span class="n">Ok</span><span class="p">&lt;</span><span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">TodoViewModel</span><span class="p">&gt;&gt;&gt;</span>
<span class="p">{</span>
    <span class="p">[</span><span class="nf">EndpointSummary</span><span class="p">(</span><span class="s">"List todos"</span><span class="p">)]</span>
    <span class="p">[</span><span class="nf">EndpointDescription</span><span class="p">(</span><span class="s">"List todos based on the request"</span><span class="p">)]</span>
    <span class="p">[</span><span class="nf">Tags</span><span class="p">(</span><span class="s">"Todo"</span><span class="p">)]</span>
    <span class="p">[</span><span class="nf">EndpointName</span><span class="p">(</span><span class="k">nameof</span><span class="p">(</span><span class="n">ListTodos</span><span class="p">))]</span>
    <span class="p">[</span><span class="nf">HttpGet</span><span class="p">(</span><span class="s">"/todos"</span><span class="p">)]</span>
    <span class="k">public</span> <span class="k">override</span> <span class="n">Ok</span><span class="p">&lt;</span><span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">TodoViewModel</span><span class="p">&gt;&gt;</span> <span class="nf">Handle</span><span class="p">(</span><span class="n">ListTodosRequest</span> <span class="n">request</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">query</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="n">Todos</span><span class="p">.</span><span class="nf">AsQueryable</span><span class="p">();</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">Completed</span><span class="p">.</span><span class="n">HasValue</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">query</span> <span class="p">=</span> <span class="n">query</span><span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="n">t</span> <span class="p">=&gt;</span> <span class="n">t</span><span class="p">.</span><span class="n">Completed</span> <span class="p">==</span> <span class="n">request</span><span class="p">.</span><span class="n">Completed</span><span class="p">.</span><span class="n">Value</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="kt">var</span> <span class="n">items</span> <span class="p">=</span> <span class="n">query</span><span class="p">.</span><span class="nf">OrderBy</span><span class="p">(</span><span class="n">t</span> <span class="p">=&gt;</span> <span class="n">t</span><span class="p">.</span><span class="n">Order</span><span class="p">).</span><span class="nf">ToList</span><span class="p">();</span>

        <span class="k">return</span> <span class="n">TypedResults</span><span class="p">.</span><span class="nf">Ok</span><span class="p">(</span><span class="n">items</span><span class="p">.</span><span class="nf">Select</span><span class="p">(</span><span class="n">TodoViewModel</span><span class="p">.</span><span class="n">From</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>💡 Note, we can use a “request object” (<code class="language-plaintext highlighter-rouge">ListTodosRequest</code> in this case) to structure the input and use model binding attributes to control the process.</p>

<p>Create a new todo:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">record</span> <span class="nc">CreateTodoRequest</span>
<span class="p">{</span>
    <span class="p">[</span><span class="n">Required</span><span class="p">]</span>
    <span class="p">[</span><span class="nf">Length</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">100</span><span class="p">)]</span>
    <span class="k">public</span> <span class="n">required</span> <span class="kt">string</span> <span class="n">Title</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

    <span class="p">[</span><span class="nf">Range</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="kt">int</span><span class="p">.</span><span class="n">MaxValue</span><span class="p">)]</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">Order</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

    <span class="k">public</span> <span class="k">static</span> <span class="n">TodoItem</span> <span class="nf">From</span><span class="p">(</span><span class="n">CreateTodoRequest</span> <span class="n">todo</span><span class="p">)</span> <span class="p">=&gt;</span>
        <span class="k">new</span><span class="p">()</span> <span class="p">{</span> <span class="n">Title</span> <span class="p">=</span> <span class="n">todo</span><span class="p">.</span><span class="n">Title</span><span class="p">,</span> <span class="n">Order</span> <span class="p">=</span> <span class="n">todo</span><span class="p">.</span><span class="n">Order</span> <span class="p">};</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">CreateTodo</span><span class="p">(</span><span class="n">TodoContext</span> <span class="n">context</span><span class="p">)</span>
    <span class="p">:</span> <span class="n">EndpointBaseAsync</span><span class="p">.</span><span class="n">WithRequest</span><span class="p">&lt;</span><span class="n">CreateTodoRequest</span><span class="p">&gt;.</span><span class="n">WithResult</span><span class="p">&lt;</span><span class="n">CreatedAtRoute</span><span class="p">&lt;</span><span class="n">TodoViewModel</span><span class="p">&gt;&gt;</span>
<span class="p">{</span>
    <span class="p">[</span><span class="nf">EndpointSummary</span><span class="p">(</span><span class="s">"Create todo"</span><span class="p">)]</span>
    <span class="p">[</span><span class="nf">EndpointDescription</span><span class="p">(</span><span class="s">"Create todo based on the request"</span><span class="p">)]</span>
    <span class="p">[</span><span class="nf">Tags</span><span class="p">(</span><span class="s">"Todo"</span><span class="p">)]</span>
    <span class="p">[</span><span class="nf">EndpointName</span><span class="p">(</span><span class="k">nameof</span><span class="p">(</span><span class="n">CreateTodo</span><span class="p">))]</span>
    <span class="p">[</span><span class="nf">HttpPost</span><span class="p">(</span><span class="s">"/todos"</span><span class="p">)]</span>
    <span class="k">public</span> <span class="k">override</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">CreatedAtRoute</span><span class="p">&lt;</span><span class="n">TodoViewModel</span><span class="p">&gt;&gt;</span> <span class="nf">HandleAsync</span><span class="p">(</span>
        <span class="p">[</span><span class="n">FromBody</span><span class="p">]</span> <span class="n">CreateTodoRequest</span> <span class="n">request</span><span class="p">,</span>
        <span class="n">CancellationToken</span> <span class="n">cancellationToken</span> <span class="p">=</span> <span class="k">default</span>
    <span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">item</span> <span class="p">=</span> <span class="n">CreateTodoRequest</span><span class="p">.</span><span class="nf">From</span><span class="p">(</span><span class="n">request</span><span class="p">);</span>
        <span class="n">context</span><span class="p">.</span><span class="n">Todos</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">item</span><span class="p">);</span>

        <span class="k">await</span> <span class="n">context</span><span class="p">.</span><span class="nf">SaveChangesAsync</span><span class="p">(</span><span class="n">cancellationToken</span><span class="p">);</span>

        <span class="k">return</span> <span class="n">TypedResults</span><span class="p">.</span><span class="nf">CreatedAtRoute</span><span class="p">(</span>
            <span class="n">TodoViewModel</span><span class="p">.</span><span class="nf">From</span><span class="p">(</span><span class="n">item</span><span class="p">),</span>
            <span class="k">nameof</span><span class="p">(</span><span class="n">GetTodo</span><span class="p">),</span>
            <span class="k">new</span> <span class="nf">RouteValueDictionary</span><span class="p">(</span><span class="k">new</span> <span class="p">{</span> <span class="n">id</span> <span class="p">=</span> <span class="n">item</span><span class="p">.</span><span class="n">Id</span> <span class="p">})</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>💡Note, we can use <code class="language-plaintext highlighter-rouge">EndpointBaseAsync</code> to describe async endpoints.</p>

<h2 id="conclusion">Conclusion</h2>

<p>In this blog post, I’ve shown you how to use <code class="language-plaintext highlighter-rouge">TypedResults</code> in .NET endpoints to achieve a consistent and strongly typed API development approach. I’ve discussed the benefits of <code class="language-plaintext highlighter-rouge">TypedResults</code> over traditional <code class="language-plaintext highlighter-rouge">ActionResult</code>. Hope this article gives you enough information to get started with this approach in your .NET projects 🚀. Let me know what you think!</p>

<h2 id="references">References</h2>

<ul>
  <li><a href="https://github.com/NikiforovAll/result-endpoints-template" target="_blank" rel="noopener noreferrer">https://github.com/NikiforovAll/result-endpoints-template</a></li>
  <li><a href="https://github.com/ardalis/ApiEndpoints" target="_blank" rel="noopener noreferrer">https://github.com/ardalis/ApiEndpoints</a></li>
  <li><a href="https://learn.microsoft.com/en-us/aspnet/core/fundamentals/minimal-apis/responses?view=aspnetcore-8.0#iresult-return-values" target="_blank" rel="noopener noreferrer">https://learn.microsoft.com/en-us/aspnet/core/fundamentals/minimal-apis/responses?view=aspnetcore-8.0#iresult-return-values</a></li>
  <li><a href="https://learn.microsoft.com/en-us/aspnet/core/fundamentals/error-handling?view=aspnetcore-8.0" target="_blank" rel="noopener noreferrer">https://learn.microsoft.com/en-us/aspnet/core/fundamentals/error-handling?view=aspnetcore-8.0</a></li>
</ul>

	</div>

	

	
	<ul class="tag_box list-unstyled list-inline">
		<li><i class="fa fa-folder-open"></i></li>
		
		
		
		<li><a href="https://nikiforovall.github.io/categories.html#dotnet-ref" target="_blank" rel="noopener noreferrer">
				dotnet <span>(50)</span>
				
			</a></li>
		
		
	</ul>
	

	
	<ul class="list-inline">
		<li><i class="fa fa-tags"></i></li>
		
		
		
		<li>
			<a href="https://nikiforovall.github.io/tags.html#dotnet-ref" target="_blank" rel="noopener noreferrer">
				dotnet <span>(56)</span>
				,
			</a>
		</li>
		
		<li>
			<a href="https://nikiforovall.github.io/tags.html#aspnetcore-ref" target="_blank" rel="noopener noreferrer">
				aspnetcore <span>(24)</span>
				
			</a>
		</li>
		
		
		
	</ul>
	

	<hr>

	<div>
		<section class="share col-sm-6">
			<h4 class="section-title">Share Post</h4>
			<a class="btn btn-default btn-sm twitter" href="http://twitter.com/share?&amp;via=nikiforovall" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" target="_blank" rel="noopener noreferrer">
				<i class="fa fa-twitter fa-lg"></i>
				Twitter
			</a>
		</section>

		<section class="col-sm-6 author">
			<img src="//www.gravatar.com/avatar/e86fa0938976c38907a302ecb208f011" class="img-rounded author-image">
			<h4 class="section-title author-name">Oleksii Nikiforov</h4>
			<p class="author-bio">Jibber-jabbering about programming and IT.</p>
		</section>
	</div>

	<div class="clearfix"></div>

	<ul class="pager">
		
		<li class="previous"><a href="https://nikiforovall.github.io/dotnet/2024/08/09/dependify-ai.html" title="Supercharge your Dependify tool with AI chat assistant" target="_blank" rel="noopener noreferrer">←
				Previous</a></li>
		
		
		<li class="next">
<a href="https://nikiforovall.github.io/dotnet/2024/08/22/async-enumerable-pipelines.html" title="Building pipelines with IAsyncEnumerable in .NET" target="_blank" rel="noopener noreferrer">Next →</a>
		</li>
		
	</ul>

	<hr>
	</div>

	<div class="col-sm-2 sidebar-2">

	</div>

</article>
<div class="clearfix"></div>



    
    <script src="https://utteranc.es/client.js" repo="NikiforovAll/nikiforovall.github.io" issue-term="pathname" label="Blog" theme="preferred-color-scheme" crossorigin="anonymous" async>
    </script>





		<footer>
			<hr>
			<p>
				© 2025 Oleksii Nikiforov with <a href="http://jekyllrb.com/" target="_blank" rel="noopener noreferrer">Jekyll</a>. Theme: <a href="https://github.com/dbtek/dbyll" target="_blank" rel="noopener noreferrer">dbyll</a> by dbtek.
			</p>
		</footer>
	</div>

	<script type="text/javascript" src="https://nikiforovall.github.io/assets/resources/jquery/jquery.min.js"></script>
	<script type="text/javascript" src="https://nikiforovall.github.io/assets/resources/bootstrap/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="https://nikiforovall.github.io/assets/js/app.js"></script>
	
		<script type="text/javascript" src="https://unpkg.com/mermaid@10.9.0/dist/mermaid.min.js">
</script>
<script>
$(document).ready(function() {
    mermaid.initialize({
        theme: 'forest'
    });
});
</script>

	
</body>
</html>



<!-- Asynchronous Google Analytics snippet -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-164555539-1', 'auto');
  ga('send', 'pageview');
</script>

