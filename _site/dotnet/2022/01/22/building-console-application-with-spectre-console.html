<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Console applications with Spectre.Console | N+1 Blog</title>

	<!-- Meta Description -->
	
	<meta name="description" content="Learn an easy way to develop CLI applications">
	

	<meta name="author" content="Oleksii Nikiforov">

	<!-- Canonical URL -->
	<link rel="canonical" href="http://localhost:4000/dotnet/2022/01/22/building-console-application-with-spectre-console.html">

	<!-- Open Graph -->
	<meta property="og:title" content="Console applications with Spectre.Console">
	<meta property="og:description" content="Learn an easy way to develop CLI applications">
	<meta property="og:url" content="http://localhost:4000/dotnet/2022/01/22/building-console-application-with-spectre-console.html">
	<meta property="og:site_name" content="N+1 Blog">
	<meta property="og:type" content="article">
	
	<meta property="article:published_time" content="2022-01-22T00:00:00+02:00">
	
	<meta property="og:image" content="http://localhost:4000/assets/media/default-post-image.png">

	<!-- Twitter Card -->
	<meta name="twitter:card" content="summary_large_image">
	<meta name="twitter:site" content="@nikiforovall">
	<meta name="twitter:title" content="Console applications with Spectre.Console">
	<meta name="twitter:description" content="Learn an easy way to develop CLI applications">
	<meta name="twitter:image" content="http://localhost:4000/assets/media/default-post-image.png">

	<!-- Enable responsive viewport -->
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
	<!--[if lt IE 9]>
	<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->

	<!-- Le styles -->
	<link href="/assets/resources/bootstrap/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
	<link href="/assets/resources/syntax/syntax.css" rel="stylesheet">
	<link href="/assets/css/style.css" rel="stylesheet">

	<!-- Search Feature Styles -->
	<style>
		.layout-page .search-trigger { position: fixed; top: 45px; right: 100px; z-index: 1000; display: flex; align-items: center; gap: 10px; padding: 6px 12px; background: #f5f5f5; border: 1px solid #ddd; border-radius: 4px; cursor: pointer; min-width: 220px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); transition: all 0.15s ease; height: 34px; box-sizing: border-box; }
		.layout-post .search-trigger { position: fixed; top: 45px; right: 100px; z-index: 1000; display: flex; align-items: center; justify-content: center; padding: 0; background: #f5f5f5; border: 1px solid #ddd; border-radius: 4px; cursor: pointer; width: 34px; height: 34px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); transition: all 0.15s ease; box-sizing: border-box; }
		.search-trigger:hover { background: #ebebeb; border-color: #c0c0c0; box-shadow: 0 2px 5px rgba(0,0,0,0.08); }
		.search-icon { color: #666; font-size: 14px; display: flex; align-items: center; }
		.search-placeholder { flex: 1; color: #999; font-size: 14px; user-select: none; }
		.search-keybind { display: flex; gap: 4px; align-items: center; }
		.search-key { font-family: 'Courier New', monospace; font-size: 11px; padding: 2px 6px; background: #e0e0e0; border: 1px solid #ccc; border-bottom: 2px solid #bbb; border-radius: 3px; color: #333; line-height: 1.2; box-shadow: 0 1px 1px rgba(0,0,0,0.1); }
		.layout-post .search-placeholder { display: none; }
		.layout-post .search-keybind { display: none; }
		.search-modal { position: fixed; top: 0; left: 0; right: 0; bottom: 0; z-index: 10000; display: none; align-items: flex-start; justify-content: center; padding-top: 10vh; }
		.search-modal.open { display: flex; animation: fadeIn 0.2s ease; }
		@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
		.search-backdrop { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.5); backdrop-filter: blur(2px); }
		.search-modal-container { position: relative; width: 90%; max-width: 600px; background: white; border-radius: 8px; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3); overflow: hidden; }
		.search-input-container { display: flex; align-items: center; padding: 16px 20px; border-bottom: 1px solid #e0e0e0; gap: 12px; }
		.search-modal-icon { color: #666; font-size: 18px; }
		.search-modal-input { flex: 1; border: none; outline: none; font-size: 16px; color: #333; background: transparent; }
		.search-modal-input::placeholder { color: #999; }
		.search-close-btn { background: transparent; border: none; color: #999; font-size: 18px; cursor: pointer; padding: 4px 8px; border-radius: 4px; transition: all 0.15s ease; }
		.search-close-btn:hover { background: #f0f0f0; color: #333; }
		.search-results { max-height: 60vh; overflow-y: auto; padding: 8px; }
		.search-hint { padding: 40px 20px; text-align: center; color: #999; font-size: 14px; }
		.search-result-item { padding: 12px 16px; border-radius: 6px; cursor: pointer; transition: background-color 0.15s ease; border: 2px solid transparent; margin-bottom: 4px; }
		.search-result-item:hover { background: #f5f5f5; }
		.search-result-item.selected { background: #e8f4f8; border-color: #4a90e2; }
		.search-footer { display: flex; justify-content: center; gap: 20px; padding: 12px 20px; border-top: 1px solid #e0e0e0; background: #fafafa; font-size: 12px; color: #666; }
		.search-footer kbd { font-family: 'Courier New', monospace; font-size: 11px; padding: 2px 5px; background: white; border: 1px solid #ddd; border-radius: 3px; color: #333; box-shadow: 0 1px 1px rgba(0,0,0,0.1); }
		@media (max-width: 768px) { .layout-page .search-trigger, .layout-post .search-trigger { display: none; } .search-modal { padding-top: 5vh; } .search-modal-container { width: 95%; max-width: none; margin: 0 10px; } .search-results { max-height: 50vh; } .search-footer { flex-wrap: wrap; gap: 10px; } }
	</style>

	<!-- Le fav and touch icons -->
	<!-- Update these with your own images
	<link rel="shortcut icon" href="images/favicon.ico">
	<link rel="apple-touch-icon" href="images/apple-touch-icon.png">
	<link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
	-->
	<link rel="shortcut icon" href="/assets/media/favicon.ico">

	<link rel="alternate" type="application/rss+xml" title="" href="http://localhost:4000/feed.xml">

	
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Console applications with Spectre.Console",
  
  
  "description": "Learn an easy way to develop CLI applications",
  
  "image": ["http://localhost:4000/assets/media/default-post-image.png"],
  "datePublished": "2022-01-22T00:00:00+02:00",
  "dateModified": "2022-01-22T00:00:00+02:00",
  "author": {
    "@type": "Person",
    "name": "Oleksii Nikiforov",
    "url": "http://localhost:4000/about.html",
    "sameAs": [
      "https://github.com/nikiforovAll",
      "https://twitter.com/nikiforovall",
      "https://www.linkedin.com/in/nikiforov-oleksii",
      "https://t.me/nikiforovallblog"
    ]
  },
  "publisher": {
    "@type": "Person",
    "name": "Oleksii Nikiforov",
    "logo": {
      "@type": "ImageObject",
      "url": "https://www.gravatar.com/avatar/e86fa0938976c38907a302ecb208f011?s=200"
    }
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://localhost:4000/dotnet/2022/01/22/building-console-application-with-spectre-console.html"
  },
  
  "articleSection": "dotnet",
  
  
  "keywords": "dotnet, cli, console",
  
  "inLanguage": "en-US"
}
</script>


</head>

<body class="layout-post">
	<nav class="navbar navbar-default visible-xs" role="navigation">
		<!-- Brand and toggle get grouped for better mobile display -->
		<div class="navbar-header">
			<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			
			<a type="button" class="navbar-toggle nav-link" href="http://github.com/nikiforovAll" target="_blank" rel="noopener noreferrer noopener noreferrer">
				<i class="fa-brands fa-github"></i>
			</a>
			
			
			<a type="button" class="navbar-toggle nav-link" href="http://x.com/nikiforovall" target="_blank" rel="noopener noreferrer noopener noreferrer">
				<i class="fa-brands fa-x-twitter"></i>
			</a>
			
			
			<a type="button" class="navbar-toggle nav-link" href="mailto:alexey.nikiforovall@gmail.com">
				<i class="fa-solid fa-envelope"></i>
			</a>
			
			<a class="navbar-brand" href="/">
				<img src="//www.gravatar.com/avatar/e86fa0938976c38907a302ecb208f011?s=35" class="img-circle">
				N+1 Blog
			</a>
		</div>

		<!-- Collect the nav links, forms, and other content for toggling -->
		<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
			<ul class="nav navbar-nav">
				<li class="active"><a href="/">Home</a></li>
				<li><a href="/topics.html">Topics</a></li>
				<li><a href="/about.html">About</a></li>
			</ul>
		</div>
<!-- /.navbar-collapse -->
	</nav>

	<!-- nav-menu-dropdown -->
	<div class="btn-group hidden-xs" id="nav-menu">
		<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
			<i class="fa-solid fa-bars"></i>
		</button>
		<ul class="dropdown-menu" role="menu">
			<li><a href="/"><i class="fa-solid fa-home"></i>Home</a></li>
			<li><a href="/topics.html"><i class="fa-solid fa-bookmark"></i>Topics</a></li>
			<li><a href="/about.html"><i class="fa-solid fa-pencil"></i>About</a></li>
			<li class="divider">
			<li><a href="#"><i class="fa-solid fa-arrow-up"></i>Top of Page</a></li>
		</ul>
	</div>

	<!-- Search Control -->
	<button id="search-trigger" class="search-trigger" type="button" aria-label="Open search">
		<span class="search-icon"><i class="fa-solid fa-search"></i></span>
		<span class="search-placeholder">Search</span>
		<div class="search-keybind">
			<kbd class="search-key" id="search-modifier">ctrl</kbd>
			<kbd class="search-key">K</kbd>
		</div>
	</button>

	<!-- Search Modal -->
	<div id="search-modal" class="search-modal">
		<div class="search-backdrop"></div>
		<div class="search-modal-container">
			<div class="search-input-container">
				<i class="fa-solid fa-search search-modal-icon"></i>
				<input type="text" id="search-input" class="search-modal-input" placeholder="Search blog posts..." autocomplete="off">
				<button id="search-close" class="search-close-btn" title="Close (ESC)">
					<i class="fa-solid fa-times"></i>
				</button>
			</div>
			<div id="search-results" class="search-results">
				<div class="search-hint">Type at least 2 characters to search...</div>
			</div>
			<div class="search-footer">
				<span><kbd>‚Üë</kbd> <kbd>‚Üì</kbd> to navigate</span>
				<span><kbd>‚Üµ</kbd> to select</span>
				<span><kbd>ESC</kbd> to close</span>
			</div>
		</div>
	</div>

	<div class="col-sm-3 sidebar hidden-xs" style="">
		<!-- sidebar.html -->
<header class="sidebar-header" role="banner">
	<a href="/" class="profile-link">
		<img src="//www.gravatar.com/avatar/e86fa0938976c38907a302ecb208f011?s=150" class="img-circle profile-image">
		<div class="profile-accent"></div>
	</a>
	<h3 class="title">
        <a href="/">N+1 Blog</a>
    </h3>
</header>


<div id="bio" class="text-center">
	Jibber-jabbering about programming and IT.
</div>


<div id="contact-list" class="text-center">
	<ul class="list-unstyled list-inline">
		
		<li>
			<a class="btn btn-default btn-sm" href="https://github.com/nikiforovAll" target="_blank" rel="noopener noreferrer noopener noreferrer">
				<i class="fa-brands fa-github fa-xl"></i>
			</a>
		</li>
		
		
		<li>
			<a class="btn btn-default btn-sm" href="https://x.com/nikiforovall" target="_blank" rel="noopener noreferrer noopener noreferrer">
				<i class="fa-brands fa-x-twitter fa-xl"></i>
			</a>
		</li>
		
		
		<li>
			<a class="btn btn-default btn-sm" href="https://t.me/nikiforovallblog" target="_blank" rel="noopener noreferrer noopener noreferrer">
				<i class="fa-brands fa-telegram fa-xl"></i>
			</a>
		</li>
		
		
		<li>
			<a class="btn btn-default btn-sm" href="https://linkedin.com/in/nikiforov-oleksii" target="_blank" rel="noopener noreferrer noopener noreferrer">
				<i class="fa-brands fa-linkedin fa-xl"></i>
			</a>
		</li>
		
	</ul>
	<ul id="contact-list-secondary" class="list-unstyled list-inline">
		
		<li>
			<a class="btn btn-default btn-sm" href="mailto:alexey.nikiforovall@gmail.com">
				<i class="fa-solid fa-envelope fa-xl"></i>
			</a>
		</li>
		
		<li>
			<a class="btn btn-default btn-sm" href="/feed.xml" target="_blank" rel="noopener noreferrer">
				<i class="fa-solid fa-rss fa-xl"></i>
			</a>
		</li>
	</ul>
</div>
<!-- sidebar.html end -->

	</div>

	<div class="col-sm-9 col-sm-offset-3">
		<div class="page-header">
	<h1>Console applications with Spectre.Console </h1>
</div>
<article>

	<div class="col-sm-10">

		<span class="post-date">
			
			January
			22nd,
			
			2022
		</span>

	
	
	
	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	
	<div>
		<h5><a href="/dotnet/2022/08/26/persisted-parameters-in-dotnet-cli.html">Add persisted parameters to CLI applications in .NET <span class="label label-default">dotnet</span>  <span class="label label-default">console</span>  <span class="label label-default">cli</span> </a></h5>
	</div>
	
	
	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	
	<div>
		<h5><a href="/dotnet/2021/12/20/dotnet-global-tool-copy-paster.html">Use System.CommandLine to write .NET global tools. Copy-paste-driven development with copy-paster. <span class="label label-default">dotnet</span>  <span class="label label-default">cli</span>  <span class="label label-default">console</span> </a></h5>
	</div>
	
	
	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	
	<div>
		<h5><a href="/dotnet/cli/2021/06/06/clean-cli.html">Develop Clean Command Line Applications with System.CommandLine. Clean CLI. <span class="label label-default">dotnet</span>  <span class="label label-default">cli</span>  <span class="label label-default">console</span> </a></h5>
	</div>
	
	
	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	

	
	

	

	

	
	

	<div class="article_body" style="margin-top: 30px;">
		<h2 id="tldr">TL;DR</h2>

<p><em>Spectre.Console</em> not only makes it easier to create beautiful console applications, but also it provides an application model to bind <code class="language-plaintext highlighter-rouge">args[]</code> to git-style commands.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">var</span> <span class="n">app</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">CommandApp</span><span class="p">();</span>

<span class="n">app</span><span class="p">.</span><span class="nf">Configure</span><span class="p">(</span><span class="n">c</span> <span class="p">=&gt;</span>
<span class="p">{</span>
    <span class="n">c</span><span class="p">.</span><span class="n">AddCommand</span><span class="p">&lt;</span><span class="n">ExportBots</span><span class="p">&gt;(</span><span class="s">"scrape"</span><span class="p">);</span>
    <span class="n">c</span><span class="p">.</span><span class="n">AddCommand</span><span class="p">&lt;</span><span class="n">ListBots</span><span class="p">&gt;(</span><span class="s">"list"</span><span class="p">);</span>
    <span class="n">c</span><span class="p">.</span><span class="n">AddCommand</span><span class="p">&lt;</span><span class="n">DownloadBot</span><span class="p">&gt;(</span><span class="s">"download"</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">WithExample</span><span class="p">(</span><span class="k">new</span><span class="p">[]</span> <span class="p">{</span><span class="s">"download"</span><span class="p">,</span> <span class="s">"--random"</span><span class="p">});</span>
<span class="p">});</span>

<span class="k">await</span> <span class="n">app</span><span class="p">.</span><span class="nf">RunAsync</span><span class="p">(</span><span class="n">args</span><span class="p">);</span>
</code></pre></div></div>

<p><img src="/assets/spectre/help.png" alt="help"></p>

<p>Source code: <a href="https://github.com/NikiforovAll/cli-with-spectre-console" target="_blank" rel="noopener noreferrer">https://github.com/NikiforovAll/cli-with-spectre-console</a>.</p>

<p><code class="language-plaintext highlighter-rouge">Spectre.Console.Extensions</code> - <a href="https://github.com/NikiforovAll/Spectre.Console.Extensions" target="_blank" rel="noopener noreferrer">https://github.com/NikiforovAll/Spectre.Console.Extensions</a>.</p>

<h2 id="introduction">Introduction</h2>

<p>Previously, I shared with you how to use <code class="language-plaintext highlighter-rouge">System.CommandLine</code> to develop CLI applications in my <a href="https://nikiforovall.github.io/dotnet/cli/2021/06/06/clean-cli.html" target="_blank" rel="noopener noreferrer">‚ÄúDevelop Clean Command Line Applications with System.CommandLine. Clean CLI‚Äù</a> post. If you liked the approach and want to try an alternative solution, check out <a href="https://spectreconsole.net/" target="_blank" rel="noopener noreferrer">Spectre.Console</a>.</p>

<h2 id="ui-kit">UI Kit</h2>

<p>You can use <code class="language-plaintext highlighter-rouge">Spectre.Console.AnsiConsole</code> to:</p>

<ul>
  <li>Output text with different colors and styles</li>
  <li>Interact with the user - prompt, selection</li>
  <li>Render complex UI elements/widgets: tables, trees, ASCII images, status control, progress bars, etc.</li>
</ul>

<p><img src="/assets/spectre/ui-kit.png" width="800">
<!-- ![ui-kit.png](/assets/spectre/ui-kit.png) --></p>

<p>Credits: <a href="https://spectreconsole.net/" target="_blank" rel="noopener noreferrer">https://spectreconsole.net/</a></p>

<h2 id="extensions">Extensions</h2>

<p><em>Spectre.Console</em> is quite extensible and you can build custom <code class="language-plaintext highlighter-rouge">IRenderable</code> components on top of it. This is what I did. I developed additional widgets for <em>Spectre.Console</em> and put them inside NuGet packages <code class="language-plaintext highlighter-rouge">Spectre.Console.Extensions</code>:</p>

<table>
  <thead>
    <tr>
      <th>Package</th>
      <th>Version</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">Spectre.Console.Extensions.Progress</code></td>
      <td><a href="https://nuget.org/packages/Spectre.Console.Extensions.Progress" target="_blank" rel="noopener noreferrer"><img src="https://img.shields.io/nuget/v/Spectre.Console.Extensions.Progress.svg" alt="Nuget"></a></td>
      <td>IProgress adapter and HttpClient reporting.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">Spectre.Console.Extensions.Table</code></td>
      <td><a href="https://nuget.org/packages/Spectre.Console.Extensions.Table" target="_blank" rel="noopener noreferrer"><img src="https://img.shields.io/nuget/v/Spectre.Console.Extensions.Table.svg" alt="Nuget"></a></td>
      <td>DataTable and DataSet support.</td>
    </tr>
  </tbody>
</table>

<hr>

<p><code class="language-plaintext highlighter-rouge">Spectre.Console.Extensions.Progress</code> provides an adapter of BCL‚Äôs <code class="language-plaintext highlighter-rouge">System.IProgress</code> to <code class="language-plaintext highlighter-rouge">Spectre.Progress</code>. Also, there is an option to plug <code class="language-plaintext highlighter-rouge">HttpClient</code> into <code class="language-plaintext highlighter-rouge">Spectre.Progress</code> so you can automatically report progress of downloading something.</p>

<p><code class="language-plaintext highlighter-rouge">Spectre.Console.Extensions.Table</code> allows to draw well-known <code class="language-plaintext highlighter-rouge">System.Data.DataSet</code> and <code class="language-plaintext highlighter-rouge">System.Data.DataTable</code> by using <code class="language-plaintext highlighter-rouge">Spectre.Table</code>.</p>

<h2 id="example---net-bots-scrapper">Example - .NET Bots scrapper</h2>

<p>I will show you how to develop CLI application based on <em>Spectre.Console</em>.</p>

<p>The goal is to fetch bots from .NET bot gallery <a href="https://mod-dotnet-bot.net/gallery/" target="_blank" rel="noopener noreferrer">https://mod-dotnet-bot.net/gallery/</a> and show a bot inside a console.</p>

<p>Here is <code class="language-plaintext highlighter-rouge">--help</code> output looks like:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>dotnet run <span class="nt">--</span> <span class="nt">-h</span>
USAGE:
    dotnet-bots.dll <span class="o">[</span>OPTIONS] &lt;COMMAND&gt;

EXAMPLES:
    dotnet-bots.dll download dotnet-bot-1.png
    dotnet-bots.dll download <span class="nt">--random</span>

OPTIONS:
    <span class="nt">-h</span>, <span class="nt">--help</span>       Prints <span class="nb">help </span>information
    <span class="nt">-v</span>, <span class="nt">--version</span>    Prints version information

COMMANDS:
    scrape
    list
    download
</code></pre></div></div>

<h3 id="entry-point---programcs">Entry Point - <code class="language-plaintext highlighter-rouge">Program.cs</code>
</h3>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">var</span> <span class="n">services</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ServiceCollection</span><span class="p">();</span>

<span class="n">services</span><span class="p">.</span><span class="n">AddDbContext</span><span class="p">&lt;</span><span class="n">RobotContext</span><span class="p">&gt;(</span><span class="n">opt</span> <span class="p">=&gt;</span> <span class="n">opt</span><span class="p">.</span><span class="nf">UseSqlite</span><span class="p">(</span><span class="s">"Data Source=robots.db"</span><span class="p">));</span>
<span class="n">services</span><span class="p">.</span><span class="nf">AddHttpClient</span><span class="p">();</span>

<span class="kt">var</span> <span class="n">app</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">CommandApp</span><span class="p">(</span><span class="k">new</span> <span class="nf">TypeRegistrar</span><span class="p">(</span><span class="n">services</span><span class="p">));</span>

<span class="n">app</span><span class="p">.</span><span class="nf">Configure</span><span class="p">(</span><span class="n">c</span> <span class="p">=&gt;</span>
<span class="p">{</span>
    <span class="n">c</span><span class="p">.</span><span class="n">AddCommand</span><span class="p">&lt;</span><span class="n">ExportBots</span><span class="p">&gt;(</span><span class="s">"scrape"</span><span class="p">);</span>
    <span class="n">c</span><span class="p">.</span><span class="n">AddCommand</span><span class="p">&lt;</span><span class="n">ListBots</span><span class="p">&gt;(</span><span class="s">"list"</span><span class="p">);</span>
    <span class="n">c</span><span class="p">.</span><span class="n">AddCommand</span><span class="p">&lt;</span><span class="n">DownloadBot</span><span class="p">&gt;(</span><span class="s">"download"</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">WithExample</span><span class="p">(</span><span class="k">new</span><span class="p">[]</span> <span class="p">{</span><span class="s">"download"</span><span class="p">,</span> <span class="s">"dotnet-bot-1.png"</span><span class="p">})</span>
        <span class="p">.</span><span class="nf">WithExample</span><span class="p">(</span><span class="k">new</span><span class="p">[]</span> <span class="p">{</span><span class="s">"download"</span><span class="p">,</span> <span class="s">"--random"</span><span class="p">});</span>
<span class="p">});</span>

<span class="k">await</span> <span class="n">app</span><span class="p">.</span><span class="nf">RunAsync</span><span class="p">(</span><span class="n">args</span><span class="p">);</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">Spectre.Console.Cli.CommandApp</code> defines the structure of the CLI application.</p>

<p>It is very easy to define git-style (verb) commands. As you can see, we adding three commands to the configuration.</p>

<p>If you have a more complex scenario, you might want to use <code class="language-plaintext highlighter-rouge">AddBranch</code> method you can organize your commands in a tree-like structure, e.g.:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">var</span> <span class="n">app2</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">CommandApp</span><span class="p">();</span>

<span class="n">app2</span><span class="p">.</span><span class="nf">Configure</span><span class="p">(</span><span class="n">c</span> <span class="p">=&gt;</span>
<span class="p">{</span>
    <span class="n">c</span><span class="p">.</span><span class="nf">AddBranch</span><span class="p">(</span><span class="s">"bots"</span><span class="p">,</span> <span class="n">bots</span> <span class="p">=&gt;</span>
    <span class="p">{</span>
        <span class="c1">// bot.exe bots list</span>
        <span class="n">bots</span><span class="p">.</span><span class="n">AddCommand</span><span class="p">&lt;</span><span class="n">ListBots</span><span class="p">&gt;(</span><span class="s">"list"</span><span class="p">);</span>
        <span class="n">bots</span><span class="p">.</span><span class="nf">AddBranch</span><span class="p">(</span><span class="s">"download"</span><span class="p">,</span> <span class="n">create</span> <span class="p">=&gt;</span>
        <span class="p">{</span>
            <span class="c1">// bot.exe bots download table</span>
            <span class="n">create</span><span class="p">.</span><span class="n">AddCommand</span><span class="p">&lt;</span><span class="n">ExportBots</span><span class="p">&gt;(</span><span class="s">"table"</span><span class="p">);</span>
            <span class="c1">// bot.exe bots download bot &lt;bot-name.png&gt;</span>
            <span class="n">create</span><span class="p">.</span><span class="n">AddCommand</span><span class="p">&lt;</span><span class="n">DownloadBot</span><span class="p">&gt;(</span><span class="s">"bot"</span><span class="p">);</span>
        <span class="p">});</span>
    <span class="p">});</span>
<span class="p">});</span>
</code></pre></div></div>

<h3 id="export-bots---exportbotscs">Export bots - <code class="language-plaintext highlighter-rouge">ExportBots.cs</code>
</h3>

<p><code class="language-plaintext highlighter-rouge">Spectre.Console.Cli.Command&lt;T&gt;</code> defines <code class="language-plaintext highlighter-rouge">Execute</code> method, it is a handler and called by <code class="language-plaintext highlighter-rouge">CommandApp</code>. The command is created by Dependency Injection container (DI), so you can expect dependencies to be resolved via constructor injection. In the command below, we retrieve bots from external source and store them.</p>

<p>üí° You can wire up the DI container if you need by providing an implementation of <code class="language-plaintext highlighter-rouge">ITypeRegistrar</code> as the constructor parameter. Note, there are no built-in adapters in <code class="language-plaintext highlighter-rouge">Spectre.Console.Cli</code>, but you can easily find a way to implement one. Check official documentation or source code for this post.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">ExportBotsSettings</span> <span class="p">:</span> <span class="n">CommandSettings</span> <span class="p">{}</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">ExportBots</span> <span class="p">:</span> <span class="n">Command</span><span class="p">&lt;</span><span class="n">ExportBotsSettings</span><span class="p">&gt;</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="n">RobotContext</span> <span class="n">db</span><span class="p">;</span>

    <span class="k">public</span> <span class="nf">ExportBots</span><span class="p">(</span><span class="n">RobotContext</span> <span class="n">db</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="n">db</span> <span class="p">=</span> <span class="n">db</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">override</span> <span class="kt">int</span> <span class="nf">Execute</span><span class="p">(</span><span class="n">CommandContext</span> <span class="n">context</span><span class="p">,</span> <span class="n">ExportBotsSettings</span> <span class="n">settings</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// details are omitted for brevity</span>
        <span class="c1">// the actual implementation parses HTML file and collects bots</span>
        <span class="kt">var</span> <span class="n">robots</span> <span class="p">=</span> <span class="nf">FindRobots</span><span class="p">(</span><span class="n">doc</span><span class="p">).</span><span class="nf">ToList</span><span class="p">();</span>

        <span class="k">this</span><span class="p">.</span><span class="n">db</span><span class="p">.</span><span class="n">Database</span><span class="p">.</span><span class="nf">EnsureCreated</span><span class="p">();</span>
        <span class="k">this</span><span class="p">.</span><span class="n">db</span><span class="p">.</span><span class="nf">AddRange</span><span class="p">(</span><span class="n">robots</span><span class="p">);</span>

        <span class="k">try</span>
        <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="n">db</span><span class="p">.</span><span class="nf">SaveChanges</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="k">when</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">InnerException</span> <span class="k">is</span> <span class="n">not</span> <span class="k">null</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">AnsiConsole</span><span class="p">.</span><span class="nf">WriteException</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">InnerException</span><span class="p">);</span>
            <span class="k">return</span> <span class="p">-</span><span class="m">1</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="n">AnsiConsole</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">();</span>
        <span class="n">AnsiConsole</span><span class="p">.</span><span class="nf">Markup</span><span class="p">(</span><span class="s">"[default on grey] exported robots [/]"</span><span class="p">);</span>
        <span class="n">AnsiConsole</span><span class="p">.</span><span class="nf">Markup</span><span class="p">(</span><span class="s">$"[white on green] </span><span class="p">{</span><span class="n">robots</span><span class="p">.</span><span class="n">Count</span><span class="p">}</span><span class="s"> [/]"</span><span class="p">);</span>
        <span class="n">AnsiConsole</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">();</span>

        <span class="k">return</span> <span class="m">0</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<ul>
  <li>‚ûï <code class="language-plaintext highlighter-rouge">AnsiConsole.WriteException</code> <a href="https://spectreconsole.net/exceptions" target="_blank" rel="noopener noreferrer">prints</a> colored exceptions</li>
  <li>‚ûï<code class="language-plaintext highlighter-rouge">AnsiConsole.Markup</code> <a href="https://spectreconsole.net/markup" target="_blank" rel="noopener noreferrer">outputs</a> rich text to console.</li>
</ul>

<p><img src="/assets/spectre/scrape.png" alt="scrape"></p>

<h3 id="list-bots---listbotscs">List bots - <code class="language-plaintext highlighter-rouge">ListBots.cs</code>
</h3>

<p>Displaying tabular data is a very common task, here is how you can use <code class="language-plaintext highlighter-rouge">Spectre.Console.Extensions</code> to draw a table using Entity Framework. Basically, we want to transform the query to <code class="language-plaintext highlighter-rouge">System.Data.DataTable</code> object. You can always switch to <a href="https://spectreconsole.net/widgets/table" target="_blank" rel="noopener noreferrer">Spectre.Table</a>, it gives you full control over how you display data.</p>

<p>The method <code class="language-plaintext highlighter-rouge">public static IRenderable FromDataSet(this DataSet dataSet, Action&lt;Panel&gt;? configurePanel)</code> builds table that <em>Spectre.Console</em> can display.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">ListBots</span> <span class="p">:</span> <span class="n">Command</span><span class="p">&lt;</span><span class="n">ListBotsSettings</span><span class="p">&gt;</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="n">RobotContext</span> <span class="n">db</span><span class="p">;</span>

    <span class="k">public</span> <span class="nf">ListBots</span><span class="p">(</span><span class="n">RobotContext</span> <span class="n">db</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="n">db</span> <span class="p">=</span> <span class="n">db</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">override</span> <span class="kt">int</span> <span class="nf">Execute</span><span class="p">(</span><span class="n">CommandContext</span> <span class="n">context</span><span class="p">,</span> <span class="n">ListBotsSettings</span> <span class="n">settings</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">AnsiConsole</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="k">new</span> <span class="nf">FigletText</span><span class="p">(</span><span class="s">".NET Bots"</span><span class="p">).</span><span class="nf">Centered</span><span class="p">().</span><span class="nf">Color</span><span class="p">(</span><span class="n">Color</span><span class="p">.</span><span class="n">Purple</span><span class="p">));</span>

        <span class="kt">var</span> <span class="n">dataset</span> <span class="p">=</span> <span class="k">new</span> <span class="n">DataSet</span> <span class="p">{</span><span class="n">DataSetName</span> <span class="p">=</span> <span class="s">"Bot Gallery"</span><span class="p">,};</span>
        <span class="kt">var</span> <span class="n">connection</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">db</span><span class="p">.</span><span class="n">Database</span><span class="p">.</span><span class="nf">GetDbConnection</span><span class="p">();</span>

        <span class="n">dataset</span><span class="p">.</span><span class="n">Tables</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="nf">RetrieveDataTable</span><span class="p">(</span><span class="n">connection</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="n">db</span><span class="p">.</span><span class="n">Robots</span><span class="p">));</span>
        <span class="kt">var</span> <span class="n">dataSetToDisplay</span> <span class="p">=</span> <span class="n">dataset</span><span class="p">.</span><span class="nf">FromDataSet</span><span class="p">(</span><span class="n">opt</span> <span class="p">=&gt;</span> <span class="n">opt</span><span class="p">.</span><span class="nf">BorderColor</span><span class="p">(</span><span class="n">Color</span><span class="p">.</span><span class="n">Aqua</span><span class="p">));</span>
        <span class="n">AnsiConsole</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="n">dataSetToDisplay</span><span class="p">);</span>

        <span class="k">return</span> <span class="m">0</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">static</span> <span class="n">DataTable</span> <span class="nf">RetrieveDataTable</span><span class="p">(</span><span class="n">DbConnection</span> <span class="n">connection</span><span class="p">,</span> <span class="n">IQueryable</span> <span class="n">query</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">connection</span><span class="p">.</span><span class="nf">Open</span><span class="p">();</span>
        <span class="k">using</span> <span class="nn">var</span> <span class="n">cmd</span> <span class="p">=</span> <span class="n">connection</span><span class="p">.</span><span class="nf">CreateCommand</span><span class="p">();</span>
        <span class="n">cmd</span><span class="p">.</span><span class="n">Connection</span> <span class="p">=</span> <span class="n">connection</span><span class="p">;</span>
        <span class="n">cmd</span><span class="p">.</span><span class="n">CommandType</span> <span class="p">=</span> <span class="n">CommandType</span><span class="p">.</span><span class="n">Text</span><span class="p">;</span>
        <span class="n">cmd</span><span class="p">.</span><span class="n">CommandText</span> <span class="p">=</span> <span class="n">query</span><span class="p">.</span><span class="nf">ToQueryString</span><span class="p">();</span>
        <span class="k">using</span> <span class="nn">var</span> <span class="n">reader</span> <span class="p">=</span> <span class="n">cmd</span><span class="p">.</span><span class="nf">ExecuteReader</span><span class="p">();</span>
        <span class="kt">var</span> <span class="n">table</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">DataTable</span><span class="p">();</span>
        <span class="n">table</span><span class="p">.</span><span class="nf">Load</span><span class="p">(</span><span class="n">reader</span><span class="p">);</span>

        <span class="k">return</span> <span class="n">table</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<ul>
  <li>‚ûï <code class="language-plaintext highlighter-rouge">Spectre.Console.FigletText</code> <a href="https://spectreconsole.net/widgets/figlet" target="_blank" rel="noopener noreferrer">renders</a> FIGlet text.</li>
  <li>‚ûï <code class="language-plaintext highlighter-rouge">Spectre.Console.Extensions.Table.FromDataSet</code> and <code class="language-plaintext highlighter-rouge">Spectre.Console.Extensions.Table.FromDataTable</code> <a href="https://github.com/nikiforovall/Spectre.Console.Extensions#spectreconsoleextensionstable-" target="_blank" rel="noopener noreferrer">displays</a> tabular data as <em>Spectre.Console</em> tables.</li>
</ul>

<p><img src="/assets/spectre/bot-list.png" alt="list"></p>

<h3 id="download-and-display-a-bot---downloadbotcs">Download and display a bot - <code class="language-plaintext highlighter-rouge">DownloadBot.cs</code>
</h3>

<p>Let‚Äôs see how to retrieve a bot by name from the database and download and display ASCII image of the bot.</p>

<p>Before we delve into details let‚Äôs see the overall structure of the command.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">DownloadBotSettings</span> <span class="p">:</span> <span class="n">CommandSettings</span>
<span class="p">{</span>
    <span class="p">[</span><span class="nf">CommandArgument</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="s">"[name]"</span><span class="p">)]</span>
    <span class="p">[</span><span class="nf">Description</span><span class="p">(</span><span class="s">"Download bot by name"</span><span class="p">)]</span>

    <span class="k">public</span> <span class="kt">string</span><span class="p">?</span> <span class="n">Name</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

    <span class="p">[</span><span class="nf">CommandOption</span><span class="p">(</span><span class="s">"-r|--random"</span><span class="p">)]</span>
    <span class="p">[</span><span class="nf">Description</span><span class="p">(</span><span class="s">"Specifies if random bot should be stored in the system"</span><span class="p">)]</span>
    <span class="k">public</span> <span class="kt">bool</span> <span class="n">IsRandom</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">DownloadBot</span> <span class="p">:</span> <span class="n">AsyncCommand</span><span class="p">&lt;</span><span class="n">DownloadBotSettings</span><span class="p">&gt;</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="n">HttpClient</span> <span class="n">httpClient</span><span class="p">;</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="n">RobotContext</span> <span class="n">db</span><span class="p">;</span>

    <span class="k">public</span> <span class="nf">DownloadBot</span><span class="p">(</span><span class="n">HttpClient</span> <span class="n">httpClient</span><span class="p">,</span> <span class="n">RobotContext</span> <span class="n">db</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="n">httpClient</span> <span class="p">=</span> <span class="n">httpClient</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="n">db</span> <span class="p">=</span> <span class="n">db</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">override</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="nf">ExecuteAsync</span><span class="p">(</span><span class="n">CommandContext</span> <span class="n">context</span><span class="p">,</span> <span class="n">DownloadBotSettings</span> <span class="n">settings</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// omitted for brevity, will be explained in a moment</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>As you may notice, instead of <code class="language-plaintext highlighter-rouge">Command</code> we use <code class="language-plaintext highlighter-rouge">AsyncCommand</code>. It allows us to use <em>async/await</em> inside handler code, so you don‚Äôt need to do <em>sync-over-async</em>, which is not critical for this scenario, but still is a bad design choice if you have an alternative.</p>

<p><code class="language-plaintext highlighter-rouge">DownloadBotSettings</code> contains two properties. The first one is a positional argument and the second an option/flag. <em>Spectre.Console</em> binds the <code class="language-plaintext highlighter-rouge">CommandSettings</code> for you, don‚Äôt forget to pass <code class="language-plaintext highlighter-rouge">args</code> in your Program.cs <code class="language-plaintext highlighter-rouge">await app.RunAsync(args);</code>.</p>

<p>Let‚Äôs see the insides of the handler. Everything starts with user input processing and we want to make sure we have a bot name to work with.</p>

<p>If a user doesn‚Äôt specify bot name we can ask a user by using <code class="language-plaintext highlighter-rouge">AnsiConsole.Prompt</code></p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">private</span> <span class="k">void</span> <span class="nf">EnsureBotSettings</span><span class="p">(</span><span class="n">DownloadBotSettings</span> <span class="n">settings</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">settings</span><span class="p">.</span><span class="n">IsRandom</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">toSkip</span> <span class="p">=</span> <span class="n">Random</span>
            <span class="p">.</span><span class="n">Shared</span><span class="p">.</span><span class="nf">Next</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="n">db</span><span class="p">.</span><span class="n">Robots</span><span class="p">.</span><span class="nf">Count</span><span class="p">());</span>
        <span class="n">settings</span><span class="p">.</span><span class="n">Name</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">db</span>
            <span class="p">.</span><span class="n">Robots</span><span class="p">.</span><span class="nf">Skip</span><span class="p">(</span><span class="n">toSkip</span><span class="p">).</span><span class="nf">Take</span><span class="p">(</span><span class="m">1</span><span class="p">).</span><span class="nf">First</span><span class="p">().</span><span class="n">Name</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="kt">string</span><span class="p">.</span><span class="nf">IsNullOrWhiteSpace</span><span class="p">(</span><span class="n">settings</span><span class="p">.</span><span class="n">Name</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="n">settings</span><span class="p">.</span><span class="n">Name</span> <span class="p">=</span> <span class="n">AnsiConsole</span><span class="p">.</span><span class="nf">Prompt</span><span class="p">(</span>
            <span class="k">new</span> <span class="n">SelectionPrompt</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;()</span>
                <span class="p">.</span><span class="nf">Title</span><span class="p">(</span><span class="s">"What's your [green]favorite fruit[/]?"</span><span class="p">)</span>
                <span class="p">.</span><span class="nf">PageSize</span><span class="p">(</span><span class="m">5</span><span class="p">)</span>
                <span class="p">.</span><span class="nf">AddChoices</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">db</span><span class="p">.</span><span class="n">Robots</span><span class="p">.</span><span class="nf">Select</span><span class="p">(</span><span class="n">r</span> <span class="p">=&gt;</span> <span class="n">r</span><span class="p">.</span><span class="n">Name</span><span class="p">)));</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Exported bots are stored in the database, so we want to find one and try to retrieve the corresponding image and store it locally somewhere. Next, we will use <a href="https://www.nuget.org/packages/Spectre.Console.ImageSharp" target="_blank" rel="noopener noreferrer">Spectre.Console.ImageSharp</a> to display saved image.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">override</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="nf">ExecuteAsync</span><span class="p">(</span><span class="n">CommandContext</span> <span class="n">context</span><span class="p">,</span> <span class="n">DownloadBotSettings</span> <span class="n">settings</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nf">EnsureBotSettings</span><span class="p">(</span><span class="n">settings</span><span class="p">);</span>

    <span class="kt">var</span> <span class="n">robot</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">db</span><span class="p">.</span><span class="n">Robots</span><span class="p">.</span><span class="nf">First</span><span class="p">(</span><span class="n">r</span> <span class="p">=&gt;</span> <span class="n">r</span><span class="p">.</span><span class="n">Name</span> <span class="p">==</span> <span class="n">settings</span><span class="p">.</span><span class="n">Name</span><span class="p">);</span>

    <span class="kt">var</span> <span class="n">fileName</span> <span class="p">=</span> <span class="kt">string</span><span class="p">.</span><span class="n">Empty</span><span class="p">;</span>

    <span class="kt">var</span> <span class="n">httpRequestMessage</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HttpRequestMessage</span><span class="p">(</span><span class="n">HttpMethod</span><span class="p">.</span><span class="n">Get</span><span class="p">,</span> <span class="n">robot</span><span class="p">.</span><span class="n">Uri</span><span class="p">);</span>
    <span class="k">await</span> <span class="n">AnsiConsole</span><span class="p">.</span><span class="nf">Progress</span><span class="p">()</span>
        <span class="p">.</span><span class="nf">Columns</span><span class="p">(</span><span class="k">new</span> <span class="n">ProgressColumn</span><span class="p">[]</span>
        <span class="p">{</span>
            <span class="k">new</span> <span class="nf">TaskDescriptionColumn</span><span class="p">(),</span> <span class="k">new</span> <span class="nf">ProgressBarColumn</span><span class="p">(),</span> <span class="k">new</span> <span class="nf">PercentageColumn</span><span class="p">(),</span>
            <span class="k">new</span> <span class="nf">RemainingTimeColumn</span><span class="p">(),</span> <span class="k">new</span> <span class="nf">SpinnerColumn</span><span class="p">(),</span>
        <span class="p">}).</span><span class="nf">StartAsync</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">httpClient</span><span class="p">,</span> <span class="n">httpRequestMessage</span><span class="p">,</span> <span class="s">"Downloading a bot"</span><span class="p">,</span> <span class="n">SaveImageToRandomFile</span><span class="p">);</span>

    <span class="kt">var</span> <span class="n">rule</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Rule</span><span class="p">(</span><span class="s">$"[red]</span><span class="p">{</span><span class="n">robot</span><span class="p">.</span><span class="n">Name</span><span class="p">}</span><span class="s">[/]"</span><span class="p">)</span> <span class="p">{</span><span class="n">Style</span> <span class="p">=</span> <span class="n">Style</span><span class="p">.</span><span class="nf">Parse</span><span class="p">(</span><span class="s">"red dim"</span><span class="p">)};</span>
    <span class="n">AnsiConsole</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="n">rule</span><span class="p">);</span>
    <span class="kt">var</span> <span class="n">image</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">CanvasImage</span><span class="p">(</span><span class="n">fileName</span><span class="p">).</span><span class="nf">MaxWidth</span><span class="p">(</span><span class="m">16</span><span class="p">);</span>
    <span class="n">AnsiConsole</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">();</span>
    <span class="n">AnsiConsole</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="k">new</span> <span class="nf">Panel</span><span class="p">(</span><span class="n">image</span><span class="p">).</span><span class="nf">BorderColor</span><span class="p">(</span><span class="n">Color</span><span class="p">.</span><span class="n">Maroon</span><span class="p">));</span>

    <span class="k">return</span> <span class="m">0</span><span class="p">;</span>

    <span class="k">async</span> <span class="n">Task</span> <span class="nf">SaveImageToRandomFile</span><span class="p">(</span><span class="n">Stream</span> <span class="n">stream</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">fileName</span> <span class="p">=</span> <span class="n">Path</span><span class="p">.</span><span class="nf">GetTempPath</span><span class="p">()</span> <span class="p">+</span> <span class="n">Guid</span><span class="p">.</span><span class="nf">NewGuid</span><span class="p">().</span><span class="nf">ToString</span><span class="p">()</span> <span class="p">+</span> <span class="s">".png"</span><span class="p">;</span>
        <span class="k">await</span> <span class="k">using</span> <span class="nn">var</span> <span class="n">fileStream</span> <span class="p">=</span> <span class="n">File</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="n">fileName</span><span class="p">);</span>
        <span class="n">stream</span><span class="p">.</span><span class="nf">Seek</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="n">SeekOrigin</span><span class="p">.</span><span class="n">Begin</span><span class="p">);</span>
        <span class="k">await</span> <span class="n">stream</span><span class="p">.</span><span class="nf">CopyToAsync</span><span class="p">(</span><span class="n">fileStream</span><span class="p">);</span>
    <span class="p">}</span>
</code></pre></div></div>

<ul>
  <li>‚ûï <code class="language-plaintext highlighter-rouge">Spectre.Console.SelectionPrompt</code> <a href="https://spectreconsole.net/prompts/selection" target="_blank" rel="noopener noreferrer">prompts</a> user to select an option from provided list.</li>
  <li>‚ûï <code class="language-plaintext highlighter-rouge">Spectre.Console.Extensions.Progress.StartAsync</code> <a href="https://github.com/NikiforovAll/Spectre.Console.Extensions#reporting-for-httpclient" target="_blank" rel="noopener noreferrer">adds</a> HttpClient reporting capabilities by using <a href="https://spectreconsole.net/live/progress" target="_blank" rel="noopener noreferrer">Spectre.Console.Progress</a>. ‚ö† You might want to check the implementation before using it because it performs additional buffering to do the reporting trick.</li>
  <li>‚ûï <code class="language-plaintext highlighter-rouge">Spectre.Console.ImageSharp.CanvasImage</code> <a href="https://spectreconsole.net/widgets/canvas-image" target="_blank" rel="noopener noreferrer">displays</a> ASCII images to console.</li>
</ul>

<p><img src="/assets/spectre/download-bot.png" alt="download"></p>

<p>üí° For full-featured terminal UI applications (TUIs) you might want to try something like <a href="https://github.com/migueldeicaza/gui.cs" target="_blank" rel="noopener noreferrer">Terminal.Gui</a></p>

<hr>

<h2 id="summary">Summary</h2>

<p><em>Spectre.Console</em> gives you everything you need to start developing good-looking and functional CLI applications. It gives you enough structure and building blocks to naturally evolve your applications over time.</p>

	</div>

	

	
	<ul class="list-inline">
		<li>
<i class="fa-solid fa-bookmark"></i> Topics:</li>
		
		
		
		<li>
			<a href="/topics.html#dotnet-cat-ref">
				dotnet <span>(60)</span>
			</a>
			 ¬∑
		</li>
		
		
		
		
		
		<li>
			<a href="/topics.html#dotnet-tag-ref">
				dotnet <span>(65)</span>
			</a>
			 ¬∑
		</li>
		
		<li>
			<a href="/topics.html#cli-tag-ref">
				cli <span>(10)</span>
			</a>
			 ¬∑
		</li>
		
		<li>
			<a href="/topics.html#console-tag-ref">
				console <span>(4)</span>
			</a>
			
		</li>
		
		
		
	</ul>
	

	<hr>

	<div>
		<section class="share col-sm-6">
			<h4 class="section-title">Share Post</h4>
			<a class="btn btn-default btn-sm twitter" href="http://x.com/share?&amp;via=nikiforovall" onclick="window.open(this.href, 'x-share', 'width=550,height=235');return false;" target="_blank" rel="noopener noreferrer">
				<i class="fa-brands fa-x-twitter fa-lg"></i>
				X
			</a>
		</section>

		<section class="col-sm-6 author">
			<img src="//www.gravatar.com/avatar/e86fa0938976c38907a302ecb208f011" class="img-rounded author-image">
			<h4 class="section-title author-name">Oleksii Nikiforov</h4>
			<p class="author-bio">Jibber-jabbering about programming and IT.</p>
		</section>
	</div>

	<div class="clearfix"></div>

	<ul class="pager">
		
		<li class="previous"><a href="/dotnet/2021/12/20/dotnet-global-tool-copy-paster.html" title="Use System.CommandLine to write .NET global tools. Copy-paste-driven development with copy-paster.">‚Üê
				Previous</a></li>
		
		
		<li class="next">
<a href="/dotnet/aspnetcore/microservices/2022/02/06/http-sdks.html" title="Creating and Using HTTP Client SDKs in .NET 6. (Announcement)">Next ‚Üí</a>
		</li>
		
	</ul>

	<hr>
	</div>

	<div class="col-sm-2 sidebar-2">

	</div>

</article>
<div class="clearfix"></div>



    
    <script src="https://utteranc.es/client.js" repo="NikiforovAll/nikiforovall.github.io" issue-term="pathname" label="Blog" theme="preferred-color-scheme" crossorigin="anonymous" async>
    </script>





		<footer>
			<hr>
			<p>
				¬© 2026 Oleksii Nikiforov with <a href="http://jekyllrb.com/" target="_blank" rel="noopener noreferrer">Jekyll</a>. Theme: <a href="https://github.com/dbtek/dbyll" target="_blank" rel="noopener noreferrer">dbyll</a> by dbtek.
			</p>
		</footer>
	</div>

	<script type="text/javascript" src="/assets/resources/jquery/jquery.min.js"></script>
	<script type="text/javascript" src="/assets/resources/bootstrap/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="/assets/js/app.js"></script>
	<script src="https://unpkg.com/lunr/lunr.js"></script>
	<script type="text/javascript" src="/assets/js/search.js"></script>
	<script type="text/javascript" src="/assets/js/copy-code.js"></script>
	
</body>
</html>



<!-- Asynchronous Google Analytics snippet -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-164555539-1', 'auto');
  ga('send', 'pageview');
</script>

